# æŠ€æœ¯æ¶æ„æ¼”è¿›è·¯çº¿å›¾

> ä»æœ€ç®€MVPåˆ°ç”Ÿäº§çº§ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„æ¼”è¿›è¯¦è§£

---

## ğŸ“‹ ç‰ˆæœ¬æ¦‚è§ˆ

```
V1.0 åŸºç¡€ç‰ˆ (Week 1-2)
    â†“ æ·»åŠ è¯­ä¹‰ç†è§£
V2.0 æ™ºèƒ½ç‰ˆ (Week 3-6)
    â†“ æ·»åŠ æ€§èƒ½ä¼˜åŒ–
V3.0 ç”Ÿäº§ç‰ˆ (Week 7-12)
    â†“ æŒç»­æ¼”è¿›
V4.0 æœªæ¥ç‰ˆ (è§„åˆ’ä¸­)
```

| ç‰ˆæœ¬ | æ ¸å¿ƒç‰¹æ€§ | æŠ€æœ¯æ ˆ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|------|---------|--------|------|---------|
| **V1.0** | åŸºç¡€é—®ç­” + ç²¾ç¡®ç¼“å­˜ | Claude + Redis | 1-2s | å¿«é€ŸéªŒè¯ |
| **V2.0** | è¯­ä¹‰ç¼“å­˜ + RAG | + Qdrant + Embedding | 0.3-1s | å°è§„æ¨¡ç”Ÿäº§ |
| **V3.0** | å¤šæ¨¡å‹è·¯ç”± + ä¼˜åŒ– | + ç›‘æ§ + CI/CD | 0.1-0.5s | å¤§è§„æ¨¡ç”Ÿäº§ |
| **V4.0** | å¤šæ¨¡æ€ + è‡ªå­¦ä¹  | + å¼ºåŒ–å­¦ä¹  | < 0.1s | æœªæ¥æ¼”è¿› |

---

## ğŸ¯ V1.0 åŸºç¡€ç‰ˆ (MVP)

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·ç•Œé¢                       â”‚
â”‚              (é£ä¹¦ / CLIæµ‹è¯•)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ HTTP Request
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FastAPI Web Server                 â”‚
â”‚            (Python 3.11 + uvicorn)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SimpleAgent (æ ¸å¿ƒé€»è¾‘)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. æ¥æ”¶é—®é¢˜                              â”‚  â”‚
â”‚  â”‚  2. æŸ¥è¯¢Redis (ç²¾ç¡®åŒ¹é…)                  â”‚  â”‚
â”‚  â”‚  3. å¦‚æœªå‘½ä¸­ â†’ è°ƒç”¨Claude API             â”‚  â”‚
â”‚  â”‚  4. å­˜å…¥Redis                             â”‚  â”‚
â”‚  â”‚  5. è¿”å›ç­”æ¡ˆ                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â†“                    â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Redis     â”‚      â”‚   Claude API    â”‚
  â”‚  (ç¼“å­˜)     â”‚      â”‚  (Sonnet 4.5)   â”‚
  â”‚             â”‚      â”‚                 â”‚
  â”‚ Key-Value   â”‚      â”‚ Messages API    â”‚
  â”‚ ç²¾ç¡®åŒ¹é…    â”‚      â”‚ max_tokens:1024 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµè¯¦è§£

#### æµç¨‹1: é¦–æ¬¡æŸ¥è¯¢ (ç¼“å­˜æœªå‘½ä¸­)

```
ç”¨æˆ·æé—®
   â†“
[1] HTTP POST /ask
   {
     "question": "äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½?"
   }
   â†“
[2] SimpleAgent.answer(question)
   â†“
[3] Redis.get("qa:md5_hash")
   â†’ None (ç¼“å­˜æœªå‘½ä¸­)
   â†“
[4] Claude APIè°ƒç”¨
   POST https://api.anthropic.com/v1/messages
   Headers:
     - anthropic-version: 2023-06-01
     - x-api-key: sk-ant-xxx
   Body:
     {
       "model": "claude-sonnet-4.5",
       "max_tokens": 1024,
       "messages": [
         {
           "role": "user",
           "content": "ä½ æ˜¯äº§å“å®¢æœ,å›ç­”: äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½?"
         }
       ]
     }
   â†“
[5] Claudeå“åº” (1-2ç§’)
   {
     "id": "msg_xxx",
     "content": [
       {
         "type": "text",
         "text": "æˆ‘ä»¬çš„äº§å“æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½:\n1. å®æ—¶åä½œ..."
       }
     ],
     "usage": {
       "input_tokens": 45,
       "output_tokens": 120
     }
   }
   â†“
[6] å­˜å…¥Redis
   Redis.setex(
     key="qa:d8f9a7b2c1...",  # MD5å“ˆå¸Œ
     value="æˆ‘ä»¬çš„äº§å“æä¾›...",
     ttl=604800  # 7å¤©
   )
   â†“
[7] è¿”å›ç»™ç”¨æˆ·
   {
     "answer": "æˆ‘ä»¬çš„äº§å“æä¾›...",
     "source": "llm",
     "response_time": 1.8,
     "tokens_used": 165
   }
```

**æ—¶é—´åˆ†å¸ƒ:**
- HTTPå¤„ç†: 10ms
- RedisæŸ¥è¯¢: 5ms
- Claude API: 1800ms â¬…ï¸ ç“¶é¢ˆ
- Rediså†™å…¥: 5ms
- **æ€»è®¡: ~1820ms**

#### æµç¨‹2: é‡å¤æŸ¥è¯¢ (ç¼“å­˜å‘½ä¸­)

```
ç”¨æˆ·æé—® (ç›¸åŒé—®é¢˜)
   â†“
[1] HTTP POST /ask
   {
     "question": "äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½?"
   }
   â†“
[2] SimpleAgent.answer(question)
   â†“
[3] Redis.get("qa:md5_hash")
   â†’ "æˆ‘ä»¬çš„äº§å“æä¾›..." (å‘½ä¸­! âœ…)
   â†“
[4] ç›´æ¥è¿”å›
   {
     "answer": "æˆ‘ä»¬çš„äº§å“æä¾›...",
     "source": "cache",
     "response_time": 0.05,
     "tokens_used": 0  # é›¶æˆæœ¬!
   }
```

**æ—¶é—´åˆ†å¸ƒ:**
- HTTPå¤„ç†: 10ms
- RedisæŸ¥è¯¢: 40ms
- **æ€»è®¡: ~50ms (æå‡97%! ğŸš€)**

### æŠ€æœ¯æ ˆè¯¦è§£

#### 1. Webæ¡†æ¶: FastAPI

```python
# main.py
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel

app = FastAPI(title="é£ä¹¦AIå®¢æœ V1.0")

class Question(BaseModel):
    question: str
    user_id: str = None

class Answer(BaseModel):
    answer: str
    source: str  # "cache" or "llm"
    response_time: float
    tokens_used: int

@app.post("/ask", response_model=Answer)
async def ask_question(q: Question):
    """å¤„ç†é—®ç­”è¯·æ±‚"""
    result = await agent.answer(q.question)
    return Answer(**result)

@app.get("/health")
async def health_check():
    """å¥åº·æ£€æŸ¥"""
    return {
        "status": "ok",
        "version": "1.0",
        "redis": redis.ping()
    }

@app.get("/stats")
async def get_stats():
    """è·å–ç»Ÿè®¡ä¿¡æ¯"""
    return agent.get_stats()
```

**é€‰æ‹©ç†ç”±:**
- å¼‚æ­¥æ”¯æŒ (await)
- è‡ªåŠ¨APIæ–‡æ¡£ (Swagger)
- ç±»å‹éªŒè¯ (Pydantic)
- æ€§èƒ½å¥½

#### 2. ç¼“å­˜: Redis

```python
# cache/redis_cache.py
import redis
import hashlib
from typing import Optional

class RedisCache:
    def __init__(
        self,
        host: str = "localhost",
        port: int = 6379,
        db: int = 0,
        ttl: int = 604800  # 7å¤©
    ):
        self.redis = redis.Redis(
            host=host,
            port=port,
            db=db,
            decode_responses=True,
            socket_connect_timeout=3,
            socket_timeout=3
        )
        self.ttl = ttl

    def _make_key(self, question: str) -> str:
        """ç”Ÿæˆç¼“å­˜é”®"""
        hash_value = hashlib.md5(question.encode()).hexdigest()
        return f"qa:v1:{hash_value}"

    def get(self, question: str) -> Optional[str]:
        """è·å–ç¼“å­˜"""
        key = self._make_key(question)
        return self.redis.get(key)

    def set(self, question: str, answer: str):
        """è®¾ç½®ç¼“å­˜"""
        key = self._make_key(question)
        self.redis.setex(key, self.ttl, answer)

    def exists(self, question: str) -> bool:
        """æ£€æŸ¥ç¼“å­˜æ˜¯å¦å­˜åœ¨"""
        key = self._make_key(question)
        return self.redis.exists(key)

    def delete(self, question: str):
        """åˆ é™¤ç¼“å­˜"""
        key = self._make_key(question)
        self.redis.delete(key)
```

**æ•°æ®ç»“æ„:**
```
Redis Key-Value:
  Key: "qa:v1:d8f9a7b2c1e3..."
  Value: "æˆ‘ä»¬çš„äº§å“æä¾›..."
  TTL: 604800ç§’ (7å¤©)

å†…å­˜ä¼°ç®—:
  å•æ¡: ~500å­—èŠ‚ (Key + Value)
  1000æ¡: ~500KB
  10000æ¡: ~5MB
```

#### 3. LLM: Claude API

```python
# llm/claude_client.py
from anthropic import AsyncAnthropic
from typing import Tuple

class ClaudeClient:
    def __init__(self, api_key: str):
        self.client = AsyncAnthropic(api_key=api_key)
        self.model = "claude-sonnet-4.5"
        self.max_tokens = 1024

    async def ask(self, question: str) -> Tuple[str, int]:
        """
        æé—®Claude

        Returns:
            (answer, tokens_used)
        """
        message = await self.client.messages.create(
            model=self.model,
            max_tokens=self.max_tokens,
            messages=[
                {
                    "role": "user",
                    "content": self._build_prompt(question)
                }
            ]
        )

        answer = message.content[0].text
        tokens = message.usage.input_tokens + message.usage.output_tokens

        return answer, tokens

    def _build_prompt(self, question: str) -> str:
        """æ„å»ºPrompt"""
        return f"""ä½ æ˜¯äº§å“å®¢æœåŠ©æ‰‹ã€‚

è¯·ç®€æ´ã€å‡†ç¡®åœ°å›ç­”å®¢æˆ·é—®é¢˜ã€‚å¦‚æœä¸ç¡®å®š,è¯šå®è¯´æ˜ã€‚

é—®é¢˜: {question}

å›ç­”:"""
```

**APIè°ƒç”¨ç»†èŠ‚:**
```
è¯·æ±‚:
  URL: https://api.anthropic.com/v1/messages
  Method: POST
  Headers:
    - anthropic-version: 2023-06-01
    - content-type: application/json
    - x-api-key: <your-key>
  Body: {
    "model": "claude-sonnet-4.5",
    "max_tokens": 1024,
    "messages": [...]
  }

å“åº”:
  Status: 200 OK
  Body: {
    "id": "msg_xxx",
    "type": "message",
    "role": "assistant",
    "content": [...],
    "model": "claude-sonnet-4.5",
    "stop_reason": "end_turn",
    "usage": {
      "input_tokens": 45,
      "output_tokens": 120
    }
  }

æˆæœ¬:
  Input: 45 tokens Ã— $0.003/1K = $0.000135
  Output: 120 tokens Ã— $0.015/1K = $0.0018
  æ€»è®¡: $0.001935 â‰ˆ $0.002/æ¬¡
```

#### 4. æ ¸å¿ƒé€»è¾‘: SimpleAgent

```python
# agent/simple_agent.py
import time
from typing import Dict

class SimpleAgent:
    def __init__(self, cache: RedisCache, claude: ClaudeClient):
        self.cache = cache
        self.claude = claude

        # ç»Ÿè®¡ä¿¡æ¯
        self.stats = {
            "total_queries": 0,
            "cache_hits": 0,
            "cache_misses": 0,
            "total_tokens": 0,
            "total_cost": 0.0
        }

    async def answer(self, question: str) -> Dict:
        """
        å›ç­”é—®é¢˜

        Returns:
            {
                "answer": str,
                "source": "cache" | "llm",
                "response_time": float,
                "tokens_used": int
            }
        """
        start_time = time.time()
        self.stats["total_queries"] += 1

        # 1. æŸ¥è¯¢ç¼“å­˜
        cached_answer = self.cache.get(question)

        if cached_answer:
            # ç¼“å­˜å‘½ä¸­
            self.stats["cache_hits"] += 1

            return {
                "answer": cached_answer,
                "source": "cache",
                "response_time": time.time() - start_time,
                "tokens_used": 0
            }

        # 2. ç¼“å­˜æœªå‘½ä¸­,è°ƒç”¨LLM
        self.stats["cache_misses"] += 1

        answer, tokens = await self.claude.ask(question)

        # 3. å­˜å…¥ç¼“å­˜
        self.cache.set(question, answer)

        # 4. æ›´æ–°ç»Ÿè®¡
        self.stats["total_tokens"] += tokens
        self.stats["total_cost"] += tokens * 0.003 / 1000  # Sonnetä»·æ ¼

        return {
            "answer": answer,
            "source": "llm",
            "response_time": time.time() - start_time,
            "tokens_used": tokens
        }

    def get_stats(self) -> Dict:
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        cache_hit_rate = (
            self.stats["cache_hits"] / self.stats["total_queries"]
            if self.stats["total_queries"] > 0 else 0
        )

        return {
            **self.stats,
            "cache_hit_rate": cache_hit_rate,
            "avg_tokens_per_query": (
                self.stats["total_tokens"] / self.stats["cache_misses"]
                if self.stats["cache_misses"] > 0 else 0
            )
        }
```

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **ç¼“å­˜å‘½ä¸­æ—¶å“åº”** | 50ms | RedisæŸ¥è¯¢ |
| **ç¼“å­˜æœªå‘½ä¸­å“åº”** | 1800ms | Claude APIè°ƒç”¨ |
| **ç¼“å­˜å‘½ä¸­ç‡** | 20-30% | åªæœ‰å®Œå…¨ç›¸åŒçš„é—®é¢˜æ‰èƒ½å‘½ä¸­ |
| **Tokenæ¶ˆè€—** | ~165/æ¬¡ | Input 45 + Output 120 |
| **å•æ¬¡æˆæœ¬** | $0.002 | Sonnetå®šä»· |
| **QPS** | ~5 | å—é™äºClaude API |

### éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Cloud Server (å•æœº)              â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Docker Container: App             â”‚ â”‚
â”‚  â”‚  - Python 3.11                     â”‚ â”‚
â”‚  â”‚  - FastAPI + uvicorn               â”‚ â”‚
â”‚  â”‚  - Port: 8000                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Docker Container: Redis           â”‚ â”‚
â”‚  â”‚  - Redis 7.0                       â”‚ â”‚
â”‚  â”‚  - Port: 6379                      â”‚ â”‚
â”‚  â”‚  - Memory: 256MB                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTPS
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Nginx (åå‘ä»£ç†)                 â”‚
â”‚  - SSLç»ˆæ­¢                               â”‚
â”‚  - é€Ÿç‡é™åˆ¶                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
      ç”¨æˆ·/é£ä¹¦
```

### V1.0 å±€é™æ€§

| é—®é¢˜ | å½±å“ | è§£å†³æ–¹æ¡ˆ (V2.0) |
|------|------|----------------|
| âŒ åªèƒ½ç²¾ç¡®åŒ¹é… | ç¼“å­˜å‘½ä¸­ç‡ä½ (20-30%) | è¯­ä¹‰ç¼“å­˜ |
| âŒ æ— æ–‡æ¡£æ£€ç´¢ | å›ç­”è´¨é‡ä¾èµ–Prompt | RAGæ£€ç´¢ |
| âŒ å•ä¸€æ¨¡å‹ | æˆæœ¬é«˜ | å¤šæ¨¡å‹è·¯ç”± |
| âŒ å“åº”æ…¢ | 1.8s (ç¼“å­˜æœªå‘½ä¸­) | æµå¼å“åº” |
| âŒ æ— ç›‘æ§ | é—®é¢˜éš¾å‘ç° | ç›‘æ§ç³»ç»Ÿ |

---

## ğŸš€ V2.0 æ™ºèƒ½ç‰ˆ (è¯­ä¹‰ç†è§£ + RAG)

### æ¶æ„æ¼”è¿›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·ç•Œé¢                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SmartAgent (æ™ºèƒ½ä»£ç†)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. æ¥æ”¶é—®é¢˜                                                â”‚ â”‚
â”‚  â”‚ 2. é—®é¢˜å½’ä¸€åŒ– (å»é™¤è¯­æ°”è¯ã€ç»Ÿä¸€æªè¾)                        â”‚ â”‚
â”‚  â”‚ 3. å¤šçº§ç¼“å­˜æŸ¥è¯¢:                                           â”‚ â”‚
â”‚  â”‚    L1: çƒ­ç¼“å­˜ (å†…å­˜) â†’ 10ms                                â”‚ â”‚
â”‚  â”‚    L2: Redis â†’ 50ms                                        â”‚ â”‚
â”‚  â”‚    L3: è¯­ä¹‰å‘é‡æœç´¢ (Qdrant) â†’ 200ms                       â”‚ â”‚
â”‚  â”‚ 4. å¦‚æœªå‘½ä¸­ â†’ RAGæ£€ç´¢ + Claudeç”Ÿæˆ                         â”‚ â”‚
â”‚  â”‚ 5. å­˜å…¥æ‰€æœ‰ç¼“å­˜å±‚                                          â”‚ â”‚
â”‚  â”‚ 6. è¿”å›ç­”æ¡ˆ                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚          â”‚             â”‚
    â†“         â†“          â†“             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚çƒ­ç¼“å­˜   â”‚ â”‚Redisâ”‚ â”‚ Qdrant  â”‚  â”‚ é£ä¹¦çŸ¥è¯†åº“    â”‚
â”‚(å†…å­˜)  â”‚ â”‚     â”‚ â”‚å‘é‡æ•°æ®åº“â”‚  â”‚              â”‚
â”‚        â”‚ â”‚     â”‚ â”‚         â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚Dict    â”‚ â”‚K-V  â”‚ â”‚Vectors  â”‚  â”‚ â”‚æ–‡æ¡£åŠ è½½å™¨â”‚ â”‚
â”‚Top 100 â”‚ â”‚ç²¾ç¡® â”‚ â”‚è¯­ä¹‰ç›¸ä¼¼ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â†“       â”‚
                                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                 â”‚ â”‚æ–‡æ¡£åˆ†å—  â”‚ â”‚
                                 â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
                                 â”‚      â†“       â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚                           â”‚ â”‚å‘é‡åŒ–    â”‚ â”‚
     â”‚ Embedding Service         â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
     â”‚ (OpenAI/æœ¬åœ°)             â”‚      â†“       â”‚
     â”‚                           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚                           â”‚ â”‚å­˜å…¥Qdrantâ”‚ â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â†“ æ£€ç´¢
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚  RAG Engine  â”‚
                                 â”‚              â”‚
                                 â”‚ 1. å‘é‡æ£€ç´¢  â”‚
                                 â”‚ 2. é‡æ’åº    â”‚
                                 â”‚ 3. ä¸Šä¸‹æ–‡ç»„è£…â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â†“
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚  Claude API  â”‚
                                 â”‚  (å¢å¼ºPrompt)â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æŠ€æœ¯æ¼”è¿›

#### 1. è¯­ä¹‰ç¼“å­˜ç³»ç»Ÿ

**æ•°æ®æµ:**

```
é—®é¢˜: "äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½?"
   â†“
[1] é—®é¢˜å½’ä¸€åŒ–
   normalize("äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½?")
   â†’ "äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½"  # ç§»é™¤"?"
   â†“
[2] L1: çƒ­ç¼“å­˜æŸ¥è¯¢ (å†…å­˜Dict)
   çƒ­ç¼“å­˜ç»“æ„:
   {
     "äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½": {
       "answer": "...",
       "hit_count": 15,
       "last_access": 1234567890
     },
     ...
   }
   â†’ å‘½ä¸­! è¿”å›ç­”æ¡ˆ (10ms)

å¦‚æœªå‘½ä¸­ â†“

[3] L2: Redisç²¾ç¡®åŒ¹é…
   Redis.get("qa:v2:md5_hash")
   â†’ å‘½ä¸­! è¿”å›ç­”æ¡ˆ (50ms)

å¦‚æœªå‘½ä¸­ â†“

[4] L3: å‘é‡è¯­ä¹‰æœç´¢
   â‘  é—®é¢˜å‘é‡åŒ–
      Embedding("äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½")
      â†’ [0.123, -0.456, 0.789, ...]  # 384ç»´å‘é‡

   â‘¡ Qdrantå‘é‡æœç´¢
      query_vector = [0.123, -0.456, ...]

      Qdrantæœç´¢è¿‡ç¨‹:
      - ä½¿ç”¨HNSWç´¢å¼•å¿«é€Ÿæ£€ç´¢
      - è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
      - è¿”å›Top 3ç›¸ä¼¼é—®é¢˜

      ç»“æœ:
      [
        {
          "question": "ä½ ä»¬çš„äº§å“æœ‰å“ªäº›åŠŸèƒ½",  # æ³¨æ„:ä¸å®Œå…¨ä¸€æ ·
          "answer": "...",
          "score": 0.92  # ç›¸ä¼¼åº¦92%
        },
        {
          "question": "äº§å“æ”¯æŒä»€ä¹ˆåŠŸèƒ½",
          "answer": "...",
          "score": 0.87
        },
        ...
      ]

   â‘¢ ç›¸ä¼¼åº¦åˆ¤æ–­
      if score >= 0.85:  # ç›´æ¥è¿”å›é˜ˆå€¼
          return answer, score
      elif score >= 0.70:  # å‚è€ƒç­”æ¡ˆé˜ˆå€¼
          return f"å‚è€ƒç­”æ¡ˆ(ç›¸ä¼¼åº¦{score}):\n{answer}"
      else:
          return None  # ç»§ç»­ä¸‹ä¸€æ­¥

   â†’ å‘½ä¸­! è¿”å›ç­”æ¡ˆ (200ms)

å¦‚æœªå‘½ä¸­ â†“

[5] RAGæ£€ç´¢ + LLMç”Ÿæˆ
   (è§ä¸‹é¢RAGæµç¨‹)
   â†’ ç”Ÿæˆæ–°ç­”æ¡ˆ (1500ms)

[6] å­˜å…¥æ‰€æœ‰ç¼“å­˜å±‚
   - Qdrant: å­˜å…¥å‘é‡
   - Redis: å­˜å…¥K-V
   - çƒ­ç¼“å­˜: å¦‚æœé«˜é¢‘,åŠ å…¥å†…å­˜
```

**å‘é‡åŒ–æŠ€æœ¯ç»†èŠ‚:**

```python
# embedding/service.py
from openai import AsyncOpenAI

class EmbeddingService:
    def __init__(self):
        self.client = AsyncOpenAI()
        self.model = "text-embedding-3-small"
        self.dimension = 384  # è¾“å‡ºç»´åº¦

        # ç¼“å­˜embeddingç»“æœ
        self.cache = {}

    async def embed(self, text: str) -> list[float]:
        """æ–‡æœ¬å‘é‡åŒ–"""
        # æ£€æŸ¥ç¼“å­˜
        cache_key = hash(text)
        if cache_key in self.cache:
            return self.cache[cache_key]

        # è°ƒç”¨OpenAI API
        response = await self.client.embeddings.create(
            model=self.model,
            input=text,
            encoding_format="float"
        )

        embedding = response.data[0].embedding

        # å­˜å…¥ç¼“å­˜
        self.cache[cache_key] = embedding

        return embedding

    async def embed_batch(self, texts: list[str]) -> list[list[float]]:
        """æ‰¹é‡å‘é‡åŒ– (æ•ˆç‡æ›´é«˜)"""
        response = await self.client.embeddings.create(
            model=self.model,
            input=texts,  # ä¸€æ¬¡æœ€å¤š2048æ¡
            encoding_format="float"
        )

        return [data.embedding for data in response.data]
```

**Qdrantå‘é‡æ•°æ®åº“:**

```python
# vector_store/qdrant_store.py
from qdrant_client import QdrantClient
from qdrant_client.models import (
    Distance, VectorParams, PointStruct,
    SearchRequest, Filter
)

class QdrantStore:
    def __init__(self):
        self.client = QdrantClient(host="localhost", port=6333)
        self.collection_name = "qa_semantic_cache"

        # åˆ›å»ºcollection
        self._init_collection()

    def _init_collection(self):
        """åˆå§‹åŒ–collection"""
        try:
            self.client.get_collection(self.collection_name)
        except:
            self.client.create_collection(
                collection_name=self.collection_name,
                vectors_config=VectorParams(
                    size=384,  # embeddingç»´åº¦
                    distance=Distance.COSINE  # ä½™å¼¦ç›¸ä¼¼åº¦
                ),
                # HNSWç´¢å¼•å‚æ•°
                hnsw_config={
                    "m": 16,  # æ¯ä¸ªèŠ‚ç‚¹çš„è¿æ¥æ•°
                    "ef_construct": 100  # æ„å»ºæ—¶çš„æœç´¢æ·±åº¦
                }
            )

    async def add(
        self,
        question: str,
        answer: str,
        embedding: list[float],
        metadata: dict = None
    ):
        """æ·»åŠ é—®ç­”å¯¹"""
        point_id = hash(question)

        self.client.upsert(
            collection_name=self.collection_name,
            points=[
                PointStruct(
                    id=point_id,
                    vector=embedding,
                    payload={
                        "question": question,
                        "answer": answer,
                        "metadata": metadata or {},
                        "created_at": time.time()
                    }
                )
            ]
        )

    async def search(
        self,
        query_embedding: list[float],
        top_k: int = 3,
        score_threshold: float = 0.85
    ) -> list[tuple[dict, float]]:
        """è¯­ä¹‰æœç´¢"""
        results = self.client.search(
            collection_name=self.collection_name,
            query_vector=query_embedding,
            limit=top_k,
            score_threshold=score_threshold,
            with_payload=True,
            with_vectors=False  # ä¸è¿”å›å‘é‡,èŠ‚çœå¸¦å®½
        )

        return [
            (result.payload, result.score)
            for result in results
        ]
```

**æ•°æ®ç»“æ„å¯¹æ¯”:**

```
V1.0 Redisç¼“å­˜:
  Key: "qa:v1:md5_hash"
  Value: "ç­”æ¡ˆæ–‡æœ¬"
  åŒ¹é…: ç²¾ç¡®åŒ¹é…
  å‘½ä¸­ç‡: 20-30%

V2.0 å‘é‡ç¼“å­˜:
  Qdrant Point:
    ID: hash(question)
    Vector: [0.123, -0.456, ...]  # 384ç»´
    Payload: {
      "question": "é—®é¢˜æ–‡æœ¬",
      "answer": "ç­”æ¡ˆæ–‡æœ¬",
      "metadata": {...}
    }
  åŒ¹é…: ä½™å¼¦ç›¸ä¼¼åº¦ > 0.85
  å‘½ä¸­ç‡: 60-70% â¬†ï¸ æå‡2-3å€!
```

#### 2. RAGæ£€ç´¢å¼•æ“

**å®Œæ•´æ•°æ®æµ:**

```
[1] é£ä¹¦æ–‡æ¡£åŠ è½½

    é£ä¹¦APIè°ƒç”¨:
    GET /wiki/v2/spaces/{space_id}/nodes
    â†’ è·å–æ–‡æ¡£åˆ—è¡¨

    å¯¹æ¯ä¸ªæ–‡æ¡£:
    GET /docx/v1/documents/{doc_id}/raw_content
    â†’ è·å–æ–‡æ¡£å†…å®¹

    ç»“æœ:
    [
      {
        "doc_id": "doc_001",
        "title": "äº§å“åŠŸèƒ½ä»‹ç»",
        "content": "# äº§å“åŠŸèƒ½\n\næˆ‘ä»¬çš„äº§å“...",
        "url": "https://feishu.cn/docx/doc_001"
      },
      ...
    ]

    â†“

[2] æ–‡æ¡£åˆ†å—

    åˆ†å—ç­–ç•¥:
    - æŒ‰æ®µè½åˆ†å‰² (\n\n)
    - æ¯å—æœ€å¤§500å­—ç¬¦
    - å—é—´é‡å 50å­—ç¬¦ (ä¿æŒä¸Šä¸‹æ–‡è¿è´¯)

    ç¤ºä¾‹:
    åŸæ–‡æ¡£:
    "# äº§å“åŠŸèƒ½\n\næˆ‘ä»¬çš„äº§å“æä¾›ä»¥ä¸‹åŠŸèƒ½:\n\n
    1. å®æ—¶åä½œ: å¤šäººåŒæ—¶ç¼–è¾‘...(500å­—)\n\n
    2. æ–‡æ¡£ç®¡ç†: æ”¯æŒæ–‡ä»¶å¤¹...(400å­—)"

    åˆ†å—å:
    [
      {
        "chunk_id": "doc_001_chunk_0",
        "content": "# äº§å“åŠŸèƒ½\n\næˆ‘ä»¬çš„äº§å“æä¾›ä»¥ä¸‹åŠŸèƒ½:\n\n
                    1. å®æ—¶åä½œ: å¤šäººåŒæ—¶ç¼–è¾‘...",  # 500å­—
        "metadata": {
          "doc_id": "doc_001",
          "title": "äº§å“åŠŸèƒ½ä»‹ç»",
          "chunk_index": 0
        }
      },
      {
        "chunk_id": "doc_001_chunk_1",
        "content": "ç¼–è¾‘...(é‡å éƒ¨åˆ†)
                    2. æ–‡æ¡£ç®¡ç†: æ”¯æŒæ–‡ä»¶å¤¹...",  # 500å­—
        "metadata": {...}
      },
      ...
    ]

    â†“

[3] æ‰¹é‡å‘é‡åŒ–

    chunks_texts = [chunk["content"] for chunk in chunks]
    embeddings = await embedding_service.embed_batch(chunks_texts)

    æ¯ä¸ªchunk:
    Text â†’ [384ç»´å‘é‡]

    â†“

[4] å­˜å…¥Qdrant

    for chunk, embedding in zip(chunks, embeddings):
        await qdrant.add(
            text=chunk["content"],
            embedding=embedding,
            metadata=chunk["metadata"]
        )

    Qdrantä¸­å­˜å‚¨ç»“æ„:
    Collection: "feishu_docs"
    Points: [
      {
        id: "doc_001_chunk_0",
        vector: [0.1, 0.2, ...],
        payload: {
          "text": "...",
          "doc_id": "doc_001",
          "title": "äº§å“åŠŸèƒ½ä»‹ç»",
          "url": "https://...",
          "chunk_index": 0
        }
      },
      ...
    ]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ç´¢å¼•é˜¶æ®µå®Œæˆ â†‘
æŸ¥è¯¢é˜¶æ®µå¼€å§‹ â†“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[5] ç”¨æˆ·æŸ¥è¯¢ â†’ å‘é‡æ£€ç´¢

    ç”¨æˆ·é—®é¢˜: "äº§å“æ”¯æŒå¤šäººåä½œå—?"

    â‘  é—®é¢˜å‘é‡åŒ–
       query_vector = await embedding_service.embed(
           "äº§å“æ”¯æŒå¤šäººåä½œå—?"
       )
       â†’ [0.15, -0.32, ...]

    â‘¡ Qdrantæ£€ç´¢
       results = await qdrant.search(
           collection="feishu_docs",
           query_vector=query_vector,
           top_k=3,
           score_threshold=0.5
       )

       æ£€ç´¢ç»“æœ:
       [
         {
           "text": "1. å®æ—¶åä½œ: å¤šäººåŒæ—¶ç¼–è¾‘...",
           "score": 0.89,  # é«˜ç›¸ä¼¼åº¦
           "metadata": {
             "title": "äº§å“åŠŸèƒ½ä»‹ç»",
             "url": "https://..."
           }
         },
         {
           "text": "åä½œåŠŸèƒ½ä½¿ç”¨æŒ‡å—...",
           "score": 0.76,
           "metadata": {...}
         },
         {
           "text": "å¤šäººæƒé™ç®¡ç†...",
           "score": 0.68,
           "metadata": {...}
         }
       ]

    â†“

[6] ä¸Šä¸‹æ–‡ç»„è£…

    def build_context(results):
        context_parts = []

        for i, result in enumerate(results, 1):
            context_parts.append(f"""
[æ–‡æ¡£{i}] {result['metadata']['title']}
{result['text']}
æ¥æº: {result['metadata']['url']}
            """)

        return "\n\n".join(context_parts)

    context = build_context(results)

    æœ€ç»ˆcontext:
    """
    [æ–‡æ¡£1] äº§å“åŠŸèƒ½ä»‹ç»
    1. å®æ—¶åä½œ: å¤šäººåŒæ—¶ç¼–è¾‘...
    æ¥æº: https://feishu.cn/docx/doc_001

    [æ–‡æ¡£2] åä½œåŠŸèƒ½ä½¿ç”¨æŒ‡å—
    åä½œåŠŸèƒ½ä½¿ç”¨æŒ‡å—...
    æ¥æº: https://feishu.cn/docx/doc_002

    [æ–‡æ¡£3] å¤šäººæƒé™ç®¡ç†
    å¤šäººæƒé™ç®¡ç†...
    æ¥æº: https://feishu.cn/docx/doc_003
    """

    â†“

[7] å¢å¼ºçš„Prompt

    prompt = f"""
ä½ æ˜¯äº§å“å®¢æœåŠ©æ‰‹ã€‚æ ¹æ®ä»¥ä¸‹æ–‡æ¡£å›ç­”ç”¨æˆ·é—®é¢˜,ç®€æ´å‡†ç¡®ã€‚

ã€å‚è€ƒæ–‡æ¡£ã€‘
{context}

ã€ç”¨æˆ·é—®é¢˜ã€‘
{question}

ã€å›ç­”è¦æ±‚ã€‘
1. åŸºäºæ–‡æ¡£å†…å®¹å›ç­”
2. å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯,è¯šå®è¯´æ˜
3. å¯ä»¥å¼•ç”¨æ–‡æ¡£æ¥æº
4. ç®€æ´ä¸“ä¸š

ã€ä½ çš„å›ç­”ã€‘"""

    â†“

[8] Claude APIè°ƒç”¨

    message = await claude.messages.create(
        model="claude-sonnet-4.5",
        max_tokens=1024,
        messages=[
          {"role": "user", "content": prompt}
        ]
    )

    Claudeçœ‹åˆ°çš„å®Œæ•´è¾“å…¥:
    - ç³»ç»Ÿprompt (è§’è‰²å®šä¹‰)
    - 3ä¸ªç›¸å…³æ–‡æ¡£ç‰‡æ®µ
    - ç”¨æˆ·é—®é¢˜

    Claudeç”Ÿæˆ:
    "æ˜¯çš„,æˆ‘ä»¬çš„äº§å“æ”¯æŒå¤šäººå®æ—¶åä½œåŠŸèƒ½ã€‚
    æ‚¨å¯ä»¥é‚€è¯·å›¢é˜Ÿæˆå‘˜åŒæ—¶ç¼–è¾‘åŒä¸€æ–‡æ¡£,
    æ‰€æœ‰æ›´æ”¹ä¼šå®æ—¶åŒæ­¥,æ”¯æŒå†²çªè‡ªåŠ¨è§£å†³ã€‚

    è¯¦è§ã€Šäº§å“åŠŸèƒ½ä»‹ç»ã€‹: https://feishu.cn/docx/doc_001"

    â†“

[9] è¿”å›ç­”æ¡ˆ + å­˜å…¥ç¼“å­˜

    return {
      "answer": "æ˜¯çš„,æˆ‘ä»¬çš„äº§å“æ”¯æŒ...",
      "source": "rag",
      "sources": [
        {
          "title": "äº§å“åŠŸèƒ½ä»‹ç»",
          "url": "https://...",
          "relevance": 0.89
        },
        ...
      ],
      "response_time": 1.5,
      "tokens_used": 680
    }
```

**å…³é”®æŠ€æœ¯å¯¹æ¯”:**

```
V1.0: çº¯Prompt
  è¾“å…¥:
    "ä½ æ˜¯äº§å“å®¢æœ,å›ç­”: äº§å“æ”¯æŒå¤šäººåä½œå—?"
  é—®é¢˜:
    - Claudeä¸çŸ¥é“äº§å“å…·ä½“åŠŸèƒ½
    - å¯èƒ½ç¼–é€ ä¿¡æ¯ (å¹»è§‰)
    - å›ç­”ä¸å¤Ÿå‡†ç¡®

V2.0: RAGå¢å¼º
  è¾“å…¥:
    "æ ¹æ®ä»¥ä¸‹æ–‡æ¡£å›ç­”:
     [æ–‡æ¡£1] äº§å“åŠŸèƒ½ä»‹ç»
     1. å®æ—¶åä½œ: å¤šäººåŒæ—¶ç¼–è¾‘...
     ...
     é—®é¢˜: äº§å“æ”¯æŒå¤šäººåä½œå—?"
  ä¼˜åŠ¿:
    - âœ… åŸºäºçœŸå®æ–‡æ¡£
    - âœ… å‡†ç¡®æ€§å¤§å¹…æå‡
    - âœ… å¯å¼•ç”¨æ¥æº
    - âœ… é¿å…å¹»è§‰
```

### V2.0 æ€§èƒ½æŒ‡æ ‡

| åœºæ™¯ | V1.0 | V2.0 | æå‡ |
|------|------|------|------|
| **ç¼“å­˜å‘½ä¸­** | 50ms | 10ms (L1) / 50ms (L2) / 200ms (L3) | - |
| **ç¼“å­˜å‘½ä¸­ç‡** | 20-30% | 60-70% | **2-3å€** â¬†ï¸ |
| **RAGæ£€ç´¢** | N/A | 1500ms | æ–°åŠŸèƒ½ |
| **å›ç­”å‡†ç¡®ç‡** | 70% | 90%+ | **20%+** â¬†ï¸ |
| **Tokenæ¶ˆè€—** | 165/æ¬¡ | 680/æ¬¡ (RAG) / 0 (ç¼“å­˜) | å®é™…å¹³å‡: 200/æ¬¡ |

### æ•°æ®å­˜å‚¨è§„æ¨¡

```
å‡è®¾åœºæ™¯:
- é£ä¹¦æ–‡æ¡£: 100ç¯‡
- å¹³å‡æ¯ç¯‡: 5000å­—
- åˆ†å—å: 100 Ã— 10 = 1000ä¸ªchunks
- æ¯ä¸ªchunkå‘é‡: 384ç»´ Ã— 4å­—èŠ‚ = 1.5KB

å­˜å‚¨éœ€æ±‚:
- Qdrantå‘é‡: 1000 Ã— 1.5KB = 1.5MB
- Qdrant payload: 1000 Ã— 500å­—èŠ‚ = 500KB
- Redisç¼“å­˜: ~5MB (1000æ¡é—®ç­”)
- æ€»è®¡: ~7MB

æŸ¥è¯¢æ€§èƒ½:
- å‘é‡æ£€ç´¢: 200ms (HNSWç´¢å¼•)
- æ‰¹é‡æ£€ç´¢: 150ms/10æ¡ (å¹¶è¡Œ)
```

### V2.0 å±€é™æ€§

| é—®é¢˜ | å½±å“ | è§£å†³æ–¹æ¡ˆ (V3.0) |
|------|------|----------------|
| âŒ å•ä¸€å¤§æ¨¡å‹ | æˆæœ¬é«˜,ç®€å•é—®é¢˜æµªè´¹ | å¤šæ¨¡å‹è·¯ç”± |
| âŒ æ— æµå¼å“åº” | ç”¨æˆ·ç­‰å¾…ä½“éªŒå·® | æµå¼è¾“å‡º |
| âŒ ç¼ºå°‘ç›‘æ§ | æ€§èƒ½é—®é¢˜éš¾å‘ç° | å®Œæ•´ç›‘æ§ |
| âŒ æ‰‹åŠ¨éƒ¨ç½² | å‘å¸ƒæ…¢,æ˜“å‡ºé”™ | CI/CD |

---

## âš¡ V3.0 ç”Ÿäº§ç‰ˆ (å®Œæ•´ä¼˜åŒ–)

### æ¶æ„å…¨æ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 ç”¨æˆ·å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ é£ä¹¦å®¢æˆ·ç«¯  â”‚  â”‚ Webé¡µé¢     â”‚  â”‚ APIè°ƒç”¨     â”‚  â”‚ ç§»åŠ¨App     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚                â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             æ¥å…¥å±‚ (Nginx)                                    â”‚
â”‚  - SSLç»ˆæ­¢                                                                    â”‚
â”‚  - è´Ÿè½½å‡è¡¡ (è½®è¯¢/IPå“ˆå¸Œ)                                                      â”‚
â”‚  - é™æµ (60 req/min per IP)                                                  â”‚
â”‚  - é™æ€æ–‡ä»¶ç¼“å­˜                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â†“               â†“               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App Node 1  â”‚  â”‚  App Node 2  â”‚  â”‚  App Node 3  â”‚
    â”‚ (FastAPI)    â”‚  â”‚ (FastAPI)    â”‚  â”‚ (FastAPI)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚                 â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä¸šåŠ¡é€»è¾‘å±‚ (SmartAgentV3)                             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      æ™ºèƒ½è·¯ç”±å†³ç­–æ ‘                                      â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  é—®é¢˜åˆ†æ â”€â”€â†’ æ¨¡å‹é€‰æ‹© â”€â”€â†’ ç¼“å­˜ç­–ç•¥ â”€â”€â†’ æ‰§è¡Œ                              â”‚ â”‚
â”‚  â”‚    â”‚           â”‚             â”‚           â”‚                              â”‚ â”‚
â”‚  â”‚    â”œâ†’ ç®€å•     â”œâ†’ Haiku     â”œâ†’ L1-L3   â”œâ†’ æµå¼/æ‰¹é‡                     â”‚ â”‚
â”‚  â”‚    â”œâ†’ ä¸­ç­‰     â”œâ†’ Sonnet    â”‚           â”‚                              â”‚ â”‚
â”‚  â”‚    â””â†’ å¤æ‚     â””â†’ Opus      â”‚           â”‚                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚                â”‚
         â†“              â†“              â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼“å­˜é›†ç¾¤    â”‚  â”‚ å‘é‡åº“   â”‚  â”‚ æ–‡æ¡£åº“   â”‚  â”‚   LLMæœåŠ¡æ±      â”‚
â”‚             â”‚  â”‚          â”‚  â”‚          â”‚  â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ Qdrant   â”‚  â”‚ Feishu   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚çƒ­ç¼“å­˜(L1)â”‚ â”‚  â”‚ Cluster  â”‚  â”‚ Docs     â”‚  â”‚ â”‚Claude Haiku â”‚ â”‚
â”‚ â”‚æœ¬åœ°å†…å­˜  â”‚ â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ â”‚ ($0.25/1M)  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ 3 nodes  â”‚  â”‚ RAG      â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚  â”‚ +replica â”‚  â”‚ Engine   â”‚  â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Redis(L2)â”‚ â”‚  â”‚ HNSW     â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚Claude Sonnetâ”‚ â”‚
â”‚ â”‚ä¸»ä»å¤åˆ¶  â”‚ â”‚  â”‚ index    â”‚  â”‚ â”‚åˆ†å—  â”‚ â”‚  â”‚ â”‚ ($3/1M)     â”‚ â”‚
â”‚ â”‚Sentinel  â”‚ â”‚  â”‚          â”‚  â”‚ â”‚å‘é‡åŒ–â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚          â”‚  â”‚ â”‚ç´¢å¼•  â”‚ â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚Claude Opus  â”‚ â”‚
                                              â”‚ â”‚ ($15/1M)    â”‚ â”‚
                                              â”‚ â”‚ (ä»…å¤æ‚é—®é¢˜)â”‚ â”‚
                                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â†“ APIè°ƒç”¨
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚   é˜Ÿåˆ— + é‡è¯•   â”‚
                                              â”‚                 â”‚
                                              â”‚ Celery + Redis  â”‚
                                              â”‚ - é™æµæ§åˆ¶      â”‚
                                              â”‚ - å¤±è´¥é‡è¯•      â”‚
                                              â”‚ - ä¼˜å…ˆçº§é˜Ÿåˆ—    â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç›‘æ§ & æ—¥å¿—å±‚                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚Prometheus  â”‚  â”‚  Grafana   â”‚  â”‚    ELK     â”‚  â”‚  Sentry    â”‚           â”‚
â”‚  â”‚(æŒ‡æ ‡æ”¶é›†)   â”‚  â”‚ (å¯è§†åŒ–)    â”‚  â”‚  (æ—¥å¿—)     â”‚  â”‚ (é”™è¯¯è¿½è¸ª) â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â”‚  å®æ—¶ç›‘æ§:                                                                    â”‚
â”‚  - QPS / å“åº”æ—¶é—´ / é”™è¯¯ç‡                                                    â”‚
â”‚  - ç¼“å­˜å‘½ä¸­ç‡ (L1/L2/L3)                                                     â”‚
â”‚  - Tokenæ¶ˆè€— & æˆæœ¬                                                          â”‚
â”‚  - å„æ¨¡å‹ä½¿ç”¨åˆ†å¸ƒ                                                             â”‚
â”‚  - èµ„æºä½¿ç”¨ (CPU/å†…å­˜/ç½‘ç»œ)                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             CI/CD æµæ°´çº¿                                      â”‚
â”‚                                                                              â”‚
â”‚  GitHub â”€â”€â†’ Actions â”€â”€â†’ Test â”€â”€â†’ Build â”€â”€â†’ Deploy                           â”‚
â”‚              â”‚           â”‚         â”‚         â”‚                               â”‚
â”‚              â†“           â†“         â†“         â†“                               â”‚
â”‚         [Lint]    [Unit Test]  [Docker]  [K8s/Docker                        â”‚
â”‚         [Type]    [Integration]          Compose]                            â”‚
â”‚         [Format]  [E2E Test]                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåˆ›æ–°: æ™ºèƒ½æ¨¡å‹è·¯ç”±

**è·¯ç”±å†³ç­–æµç¨‹:**

```
ç”¨æˆ·é—®é¢˜è¾“å…¥
   â†“
[1] é—®é¢˜ç‰¹å¾æå–

    features = {
      "length": len(question),  # é—®é¢˜é•¿åº¦
      "complexity_words": count_complex_words(question),
      "question_type": classify_type(question),
      "has_context": check_context_needed(question)
    }

    ç¤ºä¾‹åˆ†æ:
    é—®é¢˜: "äº§å“æ”¯æŒå¯¼å‡ºå—?"
    â†’ length=9, complexity=0, type="yes_no", context=False

    é—®é¢˜: "è¯·è¯¦ç»†å¯¹æ¯”ä½ ä»¬äº§å“å’Œç«å“Aã€Bçš„åŠŸèƒ½å·®å¼‚å’Œä¼˜åŠ£åŠ¿"
    â†’ length=26, complexity=3, type="analysis", context=True

    â†“

[2] æ¨¡å‹é€‰æ‹©å†³ç­–æ ‘

    def select_model(question: str, context_length: int = 0):
        # ç®€å•é—®é¢˜ç‰¹å¾
        simple_patterns = [
            "æ˜¯ä»€ä¹ˆ", "æœ‰æ²¡æœ‰", "æ”¯æŒ", "å¯ä»¥",
            "æ€ä¹ˆ", "å¦‚ä½•", "åœ¨å“ª", "å¤šå°‘"
        ]

        # å¤æ‚é—®é¢˜ç‰¹å¾
        complex_patterns = [
            "ä¸ºä»€ä¹ˆ", "åˆ†æ", "å¯¹æ¯”", "ä¼˜ç¼ºç‚¹",
            "è¯¦ç»†", "æ·±å…¥", "åŸç†", "è¯„ä¼°"
        ]

        # åˆ¤æ–­é€»è¾‘
        q_lower = question.lower()

        # â‘  è¶…çŸ­é—®é¢˜ â†’ Haiku
        if len(question) < 15:
            return "haiku", 0.25  # $0.25/1M

        # â‘¡ ç®€å•é—®è¯¢ â†’ Haiku
        if any(p in q_lower for p in simple_patterns):
            if len(question) < 50 and context_length < 500:
                return "haiku", 0.25

        # â‘¢ å¤æ‚åˆ†æ â†’ Opus
        if any(p in q_lower for p in complex_patterns):
            return "opus", 15.0  # $15/1M

        # â‘£ é•¿ä¸Šä¸‹æ–‡ â†’ Opus
        if context_length > 2000:
            return "opus", 15.0

        # â‘¤ é»˜è®¤ â†’ Sonnet (å¹³è¡¡)
        return "sonnet", 3.0

    åº”ç”¨ç¤ºä¾‹:

    é—®é¢˜1: "äº§å“æ”¯æŒå¯¼å‡ºå—?"
    â†’ ç‰¹å¾: çŸ­(9å­—), ç®€å•å…³é”®è¯("æ”¯æŒ"), æ— å¤æ‚ä¸Šä¸‹æ–‡
    â†’ å†³ç­–: Haiku
    â†’ æˆæœ¬: $0.000025 â‰ˆ èŠ‚çœ92%

    é—®é¢˜2: "å¦‚ä½•å¼€å§‹ä½¿ç”¨äº§å“?"
    â†’ ç‰¹å¾: ä¸­ç­‰(10å­—), ç®€å•å…³é”®è¯("å¦‚ä½•"), éœ€è¦æ–‡æ¡£
    â†’ å†³ç­–: Haiku + RAG (ä¸Šä¸‹æ–‡<500å­—)
    â†’ æˆæœ¬: $0.0001 â‰ˆ èŠ‚çœ67%

    é—®é¢˜3: "äº§å“çš„å®æ—¶åä½œåŠŸèƒ½å’Œç«å“ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿?"
    â†’ ç‰¹å¾: é•¿(22å­—), å¤æ‚å…³é”®è¯("å¯¹æ¯”"), éœ€è¦æ·±åº¦åˆ†æ
    â†’ å†³ç­–: Sonnet
    â†’ æˆæœ¬: $0.003 (æ ‡å‡†)

    é—®é¢˜4: "è¯·è¯¦ç»†åˆ†æäº§å“æ¶æ„è®¾è®¡åŸç†,å¯¹æ¯”ä¸šç•Œæœ€ä½³å®è·µ"
    â†’ ç‰¹å¾: é•¿(26å­—), é«˜å¤æ‚åº¦, éœ€è¦æ·±åº¦æ€è€ƒ
    â†’ å†³ç­–: Opus
    â†’ æˆæœ¬: $0.015 (æœ€é«˜è´¨é‡)

    â†“

[3] åŠ¨æ€è°ƒæ•´ç­–ç•¥

    # æˆæœ¬ç›‘æ§
    if monthly_cost > budget * 0.8:  # é¢„ç®—å‘Šè­¦
        # é™çº§ç­–ç•¥: æ›´å¤šä½¿ç”¨Haiku
        thresholds.simple_max_length = 80  # ä»50â†’80

    # è´¨é‡ç›‘æ§
    if user_satisfaction < 0.75:  # æ»¡æ„åº¦ä½
        # å‡çº§ç­–ç•¥: æ›´å¤šä½¿ç”¨Sonnet/Opus
        thresholds.complex_min_confidence = 0.6  # ä»0.7â†’0.6

    â†“

[4] æ‰§è¡Œè°ƒç”¨

    model_name = selected_model

    # è°ƒç”¨å¯¹åº”çš„Claudeæ¨¡å‹
    response = await claude.messages.create(
        model=model_name,
        max_tokens=get_max_tokens(model_name),
        messages=[...]
    )

    # è®°å½•æ¨¡å‹ä½¿ç”¨
    metrics.model_usage[model_name] += 1
    metrics.model_tokens[model_name] += tokens
    metrics.model_cost[model_name] += cost
```

**æˆæœ¬å¯¹æ¯”è¡¨:**

| åœºæ™¯ | é—®é¢˜ç±»å‹ | V2.0 (Sonnet) | V3.0 (è·¯ç”±) | èŠ‚çœ |
|------|---------|--------------|------------|------|
| **åœºæ™¯A** | 60%ç®€å• + 40%å¤æ‚ | $3/1M Ã— 100% | $0.25Ã—60% + $3Ã—40% | **60%** |
| **åœºæ™¯B** | 80%ç®€å• + 20%å¤æ‚ | $3/1M Ã— 100% | $0.25Ã—80% + $3Ã—20% | **73%** |
| **åœºæ™¯C** | 50%ç®€å• + 40%ä¸­ç­‰ + 10%å¤æ‚ | $3/1M Ã— 100% | $0.25Ã—50% + $3Ã—40% + $15Ã—10% | **21%** |

**å®é™…æ¡ˆä¾‹:**

```
1000æ¬¡æŸ¥è¯¢ç»Ÿè®¡:
- ç®€å•é—®é¢˜: 700æ¬¡ (70%)
- ä¸­ç­‰é—®é¢˜: 250æ¬¡ (25%)
- å¤æ‚é—®é¢˜: 50æ¬¡ (5%)

V2.0æˆæœ¬:
1000 Ã— 165 tokens Ã— $3/1M = $0.495

V3.0æˆæœ¬:
- ç®€å•: 700 Ã— 100 tokens Ã— $0.25/1M = $0.0175
- ä¸­ç­‰: 250 Ã— 165 tokens Ã— $3/1M = $0.124
- å¤æ‚: 50 Ã— 300 tokens Ã— $15/1M = $0.225
æ€»è®¡: $0.367

èŠ‚çœ: $0.495 - $0.367 = $0.128 (26%)

å¦‚æœç¼“å­˜å‘½ä¸­70%:
å®é™…LLMè°ƒç”¨: 300æ¬¡
V3.0æˆæœ¬: $0.367 Ã— 0.3 = $0.110
V2.0æˆæœ¬: $0.495 Ã— 0.3 = $0.149
èŠ‚çœ: 26% + é¢å¤–çš„ç¼“å­˜èŠ‚çœ
```

### æµå¼å“åº”å®ç°

**æ•°æ®æµ:**

```
[1] ç”¨æˆ·å‘èµ·è¯·æ±‚
    POST /ask/stream
    {
      "question": "è¯¦ç»†ä»‹ç»äº§å“çš„æ ¸å¿ƒåŠŸèƒ½"
    }

    â†“

[2] æœåŠ¡å™¨å»ºç«‹SSEè¿æ¥
    Response Headers:
      Content-Type: text/event-stream
      Cache-Control: no-cache
      Connection: keep-alive

    â†“

[3] Claudeæµå¼APIè°ƒç”¨

    async with client.messages.stream(
        model=selected_model,
        max_tokens=1024,
        messages=[...]
    ) as stream:
        async for chunk in stream.text_stream:
            # å®æ—¶è·å–ç”Ÿæˆçš„æ–‡æœ¬å—
            yield chunk

    â†“

[4] å®æ—¶æ¨é€ç»™ç”¨æˆ·

    æ—¶é—´è½´:

    0ms:    è¿æ¥å»ºç«‹
            â†“
    300ms:  data: {"type":"start"}
            â†“
    500ms:  data: {"type":"content","text":"æˆ‘ä»¬çš„äº§å“"}
            â†“
    600ms:  data: {"type":"content","text":"æä¾›ä»¥ä¸‹"}
            â†“
    700ms:  data: {"type":"content","text":"æ ¸å¿ƒåŠŸèƒ½:\n\n"}
            â†“
    800ms:  data: {"type":"content","text":"1. å®æ—¶åä½œ"}
            â†“
    ...æ¯100msæ¨é€ä¸€ä¸ªchunk
            â†“
    2000ms: data: {"type":"content","text":"...è¯¦ç»†è¯´æ˜"}
            â†“
    2100ms: data: {"type":"done","tokens":165}
            â†“
    2100ms: è¿æ¥å…³é—­

    â†“

[5] ç”¨æˆ·ä½“éªŒå¯¹æ¯”

    éæµå¼ (V2.0):
    0ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2000ms â”€â”€â†’ ç­”æ¡ˆ
    [           ç­‰å¾…ä¸­...                    ]

    æµå¼ (V3.0):
    0ms â”€â”€â†’ 300ms â”€â”€â†’ 500ms â”€â”€â†’ ... â”€â”€â†’ 2000ms
    [è¿æ¥] [æˆ‘ä»¬çš„] [äº§å“æ] ...   [å®Œæˆ]

    é¦–å­—æ—¶é—´: 300ms vs 2000ms (æå‡85% âš¡)
    ç”¨æˆ·æ„ŸçŸ¥: "å³æ—¶å“åº”" vs "ç­‰å¾…"
```

**ä»£ç å®ç°:**

```python
# api/streaming.py
from fastapi import FastAPI
from fastapi.responses import StreamingResponse
from sse_starlette.sse import EventSourceResponse

app = FastAPI()

@app.post("/ask/stream")
async def ask_stream(question: Question):
    """æµå¼é—®ç­”"""

    async def generate():
        """ç”Ÿæˆå™¨å‡½æ•°"""
        try:
            # å‘é€å¼€å§‹äº‹ä»¶
            yield {
                "event": "start",
                "data": json.dumps({"status": "processing"})
            }

            # æ£€æŸ¥ç¼“å­˜ (å¦‚æœå‘½ä¸­,ç›´æ¥è¿”å›å®Œæ•´ç­”æ¡ˆ)
            cached = await cache.get(question.question)
            if cached:
                yield {
                    "event": "content",
                    "data": json.dumps({"text": cached})
                }
                yield {
                    "event": "done",
                    "data": json.dumps({
                        "source": "cache",
                        "tokens": 0
                    })
                }
                return

            # æµå¼è°ƒç”¨Claude
            full_answer = []
            token_count = 0

            async with claude.messages.stream(
                model=selected_model,
                max_tokens=1024,
                messages=[{"role": "user", "content": prompt}]
            ) as stream:
                async for chunk in stream.text_stream:
                    # å®æ—¶æ¨é€chunk
                    yield {
                        "event": "content",
                        "data": json.dumps({"text": chunk})
                    }
                    full_answer.append(chunk)

                # è·å–æœ€ç»ˆtokenç»Ÿè®¡
                token_count = stream.get_final_message().usage.total_tokens

            # å‘é€å®Œæˆäº‹ä»¶
            answer = "".join(full_answer)

            yield {
                "event": "done",
                "data": json.dumps({
                    "source": "llm",
                    "tokens": token_count,
                    "model": selected_model
                })
            }

            # å¼‚æ­¥å­˜å…¥ç¼“å­˜ (ä¸é˜»å¡å“åº”)
            asyncio.create_task(
                cache.set(question.question, answer)
            )

        except Exception as e:
            yield {
                "event": "error",
                "data": json.dumps({"error": str(e)})
            }

    return EventSourceResponse(generate())
```

### ç›‘æ§ç³»ç»Ÿ

**æŒ‡æ ‡ä½“ç³»:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  è¯·æ±‚ç›¸å…³:                                              â”‚
â”‚  - agent_requests_total{source,model}                  â”‚
â”‚  - agent_requests_duration_seconds{endpoint}           â”‚
â”‚  - agent_requests_errors_total{type}                   â”‚
â”‚                                                         â”‚
â”‚  ç¼“å­˜ç›¸å…³:                                              â”‚
â”‚  - cache_hits_total{level}  # L1/L2/L3                 â”‚
â”‚  - cache_misses_total                                  â”‚
â”‚  - cache_hit_rate{level}                               â”‚
â”‚  - cache_size_bytes{level}                             â”‚
â”‚                                                         â”‚
â”‚  LLMç›¸å…³:                                              â”‚
â”‚  - llm_tokens_total{model}                             â”‚
â”‚  - llm_cost_dollars{model}                             â”‚
â”‚  - llm_latency_seconds{model}                          â”‚
â”‚  - llm_requests_per_model{model}                       â”‚
â”‚                                                         â”‚
â”‚  è´¨é‡ç›¸å…³:                                              â”‚
â”‚  - user_satisfaction_score                             â”‚
â”‚  - human_handoff_rate                                  â”‚
â”‚  - answer_length_characters                            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç³»ç»Ÿèµ„æºæŒ‡æ ‡                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  - cpu_usage_percent                                   â”‚
â”‚  - memory_usage_bytes                                  â”‚
â”‚  - disk_usage_bytes                                    â”‚
â”‚  - network_io_bytes                                    â”‚
â”‚  - redis_connected_clients                             â”‚
â”‚  - qdrant_vector_count                                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Grafanaä»ªè¡¨æ¿:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  [å®æ—¶QPS]            [å¹³å‡å“åº”æ—¶é—´]         [é”™è¯¯ç‡]         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    42      â”‚       â”‚   320ms    â”‚       â”‚   0.2%     â”‚  â”‚
â”‚  â”‚ â–² 15%      â”‚       â”‚ â–¼ 25%      â”‚       â”‚ â–² 0.1%     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  [ç¼“å­˜å‘½ä¸­ç‡è¶‹åŠ¿]                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 100%â”¤                                                 â”‚  â”‚
â”‚  â”‚  80%â”¤     L1 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”              â”‚  â”‚
â”‚  â”‚  60%â”¤        L2 â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ                â”‚  â”‚
â”‚  â”‚  40%â”¤           L3 â•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œ                 â”‚  â”‚
â”‚  â”‚  20%â”¤                                                 â”‚  â”‚
â”‚  â”‚   0%â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚     0h    6h    12h   18h   24h                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  [æ¨¡å‹ä½¿ç”¨åˆ†å¸ƒ]           [Tokenæ¶ˆè€— & æˆæœ¬]                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Haiku:  65% â–ˆâ–ˆâ–ˆâ”‚     â”‚ ä»Šæ—¥: 1.2M tokens            â”‚  â”‚
â”‚  â”‚ Sonnet: 30% â–ˆâ–ˆ â”‚     â”‚ æˆæœ¬: $4.80                   â”‚  â”‚
â”‚  â”‚ Opus:    5% â–Œ  â”‚     â”‚ æœˆåº¦é¢„ç®—: $100 (5%å·²ä½¿ç”¨)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  [å“åº”æ—¶é—´åˆ†å¸ƒ]                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ P50: 180ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚  â”‚
â”‚  â”‚ P90: 520ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚  â”‚
â”‚  â”‚ P95: 1.2s  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚ P99: 2.8s  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  [çƒ­é—¨é—®é¢˜ Top 10]                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. äº§å“æœ‰ä»€ä¹ˆåŠŸèƒ½?               â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  156æ¬¡  â”‚  â”‚
â”‚  â”‚ 2. å¦‚ä½•å¼€å§‹ä½¿ç”¨?                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    98æ¬¡   â”‚  â”‚
â”‚  â”‚ 3. ä»·æ ¼æ˜¯å¤šå°‘?                   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      67æ¬¡   â”‚  â”‚
â”‚  â”‚ ...                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CI/CDæµæ°´çº¿

**å®Œæ•´æµç¨‹:**

```
å¼€å‘è€…æäº¤ä»£ç 
   â†“ git push
GitHub Repository
   â†“ webhookè§¦å‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GitHub Actions Workflow                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ [1] ä»£ç æ£€æŸ¥ (5åˆ†é’Ÿ)                                    â”‚
â”‚     - Lint (flake8, black)                             â”‚
â”‚     - Type check (mypy)                                â”‚
â”‚     - Security scan (bandit)                           â”‚
â”‚     â†“ å¦‚æœå¤±è´¥ â†’ åœæ­¢,é€šçŸ¥å¼€å‘è€…                        â”‚
â”‚                                                         â”‚
â”‚ [2] è‡ªåŠ¨åŒ–æµ‹è¯• (10åˆ†é’Ÿ)                                 â”‚
â”‚     - Unit tests (pytest)                              â”‚
â”‚     - Integration tests                                â”‚
â”‚     - Coverage report (> 70%)                          â”‚
â”‚     â†“ å¦‚æœå¤±è´¥ â†’ åœæ­¢                                   â”‚
â”‚                                                         â”‚
â”‚ [3] æ„å»ºDockeré•œåƒ (5åˆ†é’Ÿ)                              â”‚
â”‚     docker build -t app:${GIT_SHA}                     â”‚
â”‚     docker tag app:${GIT_SHA} app:latest               â”‚
â”‚     â†“                                                   â”‚
â”‚                                                         â”‚
â”‚ [4] æ¨é€åˆ°é•œåƒä»“åº“ (2åˆ†é’Ÿ)                              â”‚
â”‚     docker push registry/app:${GIT_SHA}                â”‚
â”‚     â†“                                                   â”‚
â”‚                                                         â”‚
â”‚ [5] éƒ¨ç½²åˆ°ç¯å¢ƒ (åˆ†æ”¯ç­–ç•¥)                               â”‚
â”‚     - developåˆ†æ”¯ â†’ æµ‹è¯•ç¯å¢ƒ                            â”‚
â”‚     - mainåˆ†æ”¯ â†’ ç”Ÿäº§ç¯å¢ƒ (éœ€è¦å®¡æ‰¹)                    â”‚
â”‚     â†“                                                   â”‚
â”‚                                                         â”‚
â”‚ [6] å¥åº·æ£€æŸ¥ (2åˆ†é’Ÿ)                                    â”‚
â”‚     - ç­‰å¾…æœåŠ¡å¯åŠ¨                                      â”‚
â”‚     - è°ƒç”¨/healthç«¯ç‚¹                                   â”‚
â”‚     - è¿è¡Œsmoke tests                                  â”‚
â”‚     â†“ å¦‚æœå¤±è´¥ â†’ è‡ªåŠ¨å›æ»š                               â”‚
â”‚                                                         â”‚
â”‚ [7] é€šçŸ¥ (1åˆ†é’Ÿ)                                        â”‚
â”‚     - Slack/é£ä¹¦é€šçŸ¥                                    â”‚
â”‚     - éƒ¨ç½²æŠ¥å‘Š                                          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
ç”Ÿäº§ç¯å¢ƒè¿è¡Œ
   â†“
ç›‘æ§å’Œå‘Šè­¦
```

### V3.0 å®Œæ•´æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | V1.0 | V2.0 | V3.0 | æå‡ (V1â†’V3) |
|------|------|------|------|-------------|
| **å¹³å‡å“åº”æ—¶é—´** | 1820ms | 400ms | 180ms | **90%** â¬‡ï¸ |
| **P95å“åº”æ—¶é—´** | 3500ms | 1200ms | 520ms | **85%** â¬‡ï¸ |
| **é¦–å­—å“åº”** | N/A | N/A | 300ms | æµå¼å“åº” |
| **ç¼“å­˜å‘½ä¸­ç‡** | 25% | 68% | 72% | **47%** â¬†ï¸ |
| **Token/æ¬¡** | 165 | 200 | 95 | **42%** â¬‡ï¸ |
| **å•æ¬¡æˆæœ¬** | $0.002 | $0.002 | $0.0008 | **60%** â¬‡ï¸ |
| **QPS** | 5 | 50 | 120 | **24x** â¬†ï¸ |
| **å¯ç”¨æ€§** | 95% | 99% | 99.5%+ | **4.5%** â¬†ï¸ |

---

## ğŸ”® V4.0 æœªæ¥ç‰ˆ (è§„åˆ’)

### æŠ€æœ¯æ¼”è¿›æ–¹å‘

```
V3.0 (å½“å‰)
   â†“ æ·»åŠ å¤šæ¨¡æ€

[1] å¤šæ¨¡æ€ç†è§£
    - å›¾ç‰‡é—®ç­” (Claude 3+ Vision)
    - è¯­éŸ³è¾“å…¥ (Whisper)
    - è§†é¢‘å†…å®¹åˆ†æ

   â†“ æ·»åŠ ä¸»åŠ¨å­¦ä¹ 

[2] å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–
    - ç”¨æˆ·åé¦ˆå¾ªç¯
    - è‡ªåŠ¨Promptä¼˜åŒ–
    - é—®é¢˜èšç±»åˆ†æ

   â†“ æ·»åŠ çŸ¥è¯†å›¾è°±

[3] çŸ¥è¯†å›¾è°±é›†æˆ
    - å®ä½“å…³ç³»æŠ½å–
    - å›¾æ•°æ®åº“ (Neo4j)
    - æ¨ç†å¢å¼º

   â†“ æ·»åŠ ä¸ªæ€§åŒ–

[4] ç”¨æˆ·ç”»åƒ
    - å†å²åå¥½å­¦ä¹ 
    - ä¸ªæ€§åŒ–æ¨è
    - å¤šè½®å¯¹è¯ä¼˜åŒ–

V4.0 (æœªæ¥)
```

### æ ¸å¿ƒæŠ€æœ¯é¢„ç ”

#### 1. å¤šæ¨¡æ€èƒ½åŠ›

```
åœºæ™¯: ç”¨æˆ·å‘é€äº§å“æˆªå›¾æé—®
"è¿™ä¸ªé¡µé¢æ€ä¹ˆä½¿ç”¨?"

æ•°æ®æµ:
ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
   â†“
å›¾ç‰‡å­˜å‚¨ (S3/OSS)
   â†“
Claude Vision API
   POST /messages
   {
     "model": "claude-3-opus-20240229",
     "messages": [
       {
         "role": "user",
         "content": [
           {
             "type": "image",
             "source": {
               "type": "url",
               "url": "https://..."
             }
           },
           {
             "type": "text",
             "text": "è¿™ä¸ªé¡µé¢æ€ä¹ˆä½¿ç”¨?"
           }
         ]
       }
     ]
   }
   â†“
Claudeç†è§£å›¾ç‰‡å†…å®¹
   â†“
è¿”å›è¯¦ç»†ä½¿ç”¨æŒ‡å—
```

#### 2. å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–

```
æ•°æ®å¾ªç¯:

ç”¨æˆ·æé—® â†’ ç³»ç»Ÿå›ç­” â†’ æ”¶é›†åé¦ˆ
   â†‘                        â†“
   â””â”€â”€â”€â”€â”€â”€ æ¨¡å‹ä¼˜åŒ– â†â”€â”€â”€â”€â”€â”€â”€â”˜

å…·ä½“å®ç°:
1. æ”¶é›†åé¦ˆ
   - ç‚¹èµ/ç‚¹è¸©
   - æ»¡æ„åº¦è¯„åˆ†
   - æ˜¯å¦è½¬äººå·¥

2. æ ‡æ³¨æ•°æ®
   {
     "question": "...",
     "answer": "...",
     "feedback": "thumbs_up",
     "user_satisfaction": 0.9
   }

3. å®šæœŸå¾®è°ƒ
   - ä½¿ç”¨æ ‡æ³¨æ•°æ®
   - å¾®è°ƒå°æ¨¡å‹
   - A/Bæµ‹è¯•æ•ˆæœ

4. è‡ªåŠ¨Promptä¼˜åŒ–
   - é—ä¼ ç®—æ³•æœç´¢æœ€ä¼˜Prompt
   - å¼ºåŒ–å­¦ä¹ è°ƒæ•´æ¸©åº¦å‚æ•°
```

---

## ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“

### æŠ€æœ¯æ ˆæ¼”è¿›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç»„ä»¶       â”‚   V1.0       â”‚   V2.0       â”‚   V3.0       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Webæ¡†æ¶      â”‚ FastAPI      â”‚ FastAPI      â”‚ FastAPI      â”‚
â”‚ ç¼“å­˜         â”‚ Redis        â”‚ Redis +      â”‚ Redis +      â”‚
â”‚              â”‚ (ç²¾ç¡®)       â”‚ Qdrant       â”‚ Qdrant +     â”‚
â”‚              â”‚              â”‚ (è¯­ä¹‰)       â”‚ çƒ­ç¼“å­˜       â”‚
â”‚ LLM          â”‚ Claude       â”‚ Claude       â”‚ Claude       â”‚
â”‚              â”‚ Sonnet       â”‚ Sonnet       â”‚ Haiku/       â”‚
â”‚              â”‚              â”‚              â”‚ Sonnet/Opus  â”‚
â”‚ Embedding    â”‚ N/A          â”‚ OpenAI       â”‚ OpenAI/æœ¬åœ°  â”‚
â”‚ å‘é‡åº“       â”‚ N/A          â”‚ Qdrant       â”‚ Qdranté›†ç¾¤   â”‚
â”‚ æ–‡æ¡£æ£€ç´¢     â”‚ N/A          â”‚ RAG          â”‚ RAGå¢å¼º      â”‚
â”‚ ç›‘æ§         â”‚ æ—            â”‚ åŸºç¡€æ—¥å¿—     â”‚ Prometheus+  â”‚
â”‚              â”‚              â”‚              â”‚ Grafana      â”‚
â”‚ CI/CD        â”‚ æ‰‹åŠ¨         â”‚ æ‰‹åŠ¨         â”‚ GitHub       â”‚
â”‚              â”‚              â”‚              â”‚ Actions      â”‚
â”‚ éƒ¨ç½²         â”‚ å•æœº         â”‚ å•æœº         â”‚ é›†ç¾¤/K8s     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ€§èƒ½æ¼”è¿›æ›²çº¿

```
å“åº”æ—¶é—´:
V1.0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  1820ms
V2.0: â–ˆâ–ˆâ–ˆâ–ˆ                   400ms
V3.0: â–ˆâ–ˆ                     180ms
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      0ms            2000ms

ç¼“å­˜å‘½ä¸­ç‡:
V1.0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                 25%
V2.0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  68%
V3.0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  72%
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      0%                    100%

æˆæœ¬/åƒæ¬¡:
V1.0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  $2.00
V2.0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  $2.00 (å®é™…çº¦$0.70,å«ç¼“å­˜)
V3.0: â–ˆâ–ˆâ–ˆâ–ˆ          $0.80
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      $0      $2.50
```

### é€‚ç”¨åœºæ™¯å»ºè®®

| ç‰ˆæœ¬ | é€‚ç”¨åœºæ™¯ | ç”¨æˆ·è§„æ¨¡ | å¼€å‘æ—¶é—´ |
|------|---------|---------|---------|
| **V1.0** | å¿«é€ŸéªŒè¯,å†…éƒ¨æµ‹è¯• | < 50 | 1å‘¨ |
| **V2.0** | å°è§„æ¨¡ç”Ÿäº§,åˆåˆ›å…¬å¸ | 50-500 | 1ä¸ªæœˆ |
| **V3.0** | å¤§è§„æ¨¡ç”Ÿäº§,ä¼ä¸šçº§ | 500+ | 3ä¸ªæœˆ |

---

## ğŸ¯ å®æ–½å»ºè®®

### æ¸è¿›å¼æ¼”è¿›è·¯å¾„

**ç¬¬1å‘¨: V1.0 MVP**
```bash
# å®‰è£…ä¾èµ–
pip install anthropic redis fastapi

# å®ç°æ ¸å¿ƒä»£ç 
- cache/redis_cache.py
- llm/claude_client.py
- agent/simple_agent.py
- main.py

# æµ‹è¯•éªŒè¯
python main.py
```

**ç¬¬2-4å‘¨: è¿‡æ¸¡åˆ°V2.0**
```bash
# æ·»åŠ æ–°ä¾èµ–
pip install qdrant-client openai

# å®ç°æ–°æ¨¡å—
- embedding/service.py
- vector_store/qdrant_store.py
- agent/smart_agent.py
- rag/engine.py

# ç°åº¦åˆ‡æ¢
if enable_semantic_cache:
    agent = SmartAgent()
else:
    agent = SimpleAgent()
```

**ç¬¬5-12å‘¨: å®Œæ•´V3.0**
```bash
# æ·»åŠ ç”Ÿäº§ä¾èµ–
pip install prometheus-client

# å®ç°ä¼˜åŒ–
- model_router.py
- streaming.py
- monitoring.py

# éƒ¨ç½²ä¼˜åŒ–
- docker-compose.yml
- k8s/deployment.yaml
- .github/workflows/deploy.yml
```

---

**æ–‡æ¡£ç‰ˆæœ¬: v1.0**
**æœ€åæ›´æ–°: 2026-02-27**
**ç»´æŠ¤è€…: AIå®¢æœæŠ€æœ¯å›¢é˜Ÿ**
