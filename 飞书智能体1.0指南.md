# 飞书AI智能体 1.0 - 完整指南

## 📚 项目说明

这是一个完整的飞书AI智能体项目，包含详细的技术设计文档和可运行的Demo代码。

### 项目目标

开发一个基于大语言模型的飞书智能客服助手，用于:
- ✅ 向客户介绍公司产品
- ✅ 回答客户提问
- ✅ 查询飞书文档提供准确答案
- ✅ 提供7x24小时智能服务

## 📁 项目结构

```
test_code/
├── docs/                           # 📋 设计文档
│   ├── PROJECT_OVERVIEW.md         # 项目总览(推荐首先阅读)
│   ├── TECH_ROADMAP.md             # 技术路线图
│   └── MODULES.md                  # 模块功能详细说明
│
├── demo/                           # 💻 可运行的Demo代码
│   ├── app.py                      # FastAPI主应用
│   ├── config.py                   # 配置管理
│   ├── feishu_connector.py         # 飞书连接模块
│   ├── ai_engine.py                # AI对话引擎
│   ├── dialog_router.py            # 对话路由器
│   ├── product_knowledge.json      # 产品知识库
│   ├── requirements.txt            # Python依赖
│   ├── .env.example                # 环境变量模板
│   └── README.md                   # Demo使用说明
│
└── FEISHU_AI_AGENT_GUIDE.md        # 本文件(快速导航)
```

## 🚀 快速开始

### 方案1: 先看文档,理解设计

适合需要全面了解技术方案的开发者:

1. **阅读项目总览**: [docs/PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md)
   - 了解项目背景和核心价值
   - 查看技术架构概览
   - 了解成本和ROI分析

2. **深入技术路线图**: [docs/TECH_ROADMAP.md](docs/TECH_ROADMAP.md)
   - 学习完整的技术架构设计
   - 理解技术栈选型理由
   - 查看实施计划和时间线

3. **研究模块设计**: [docs/MODULES.md](docs/MODULES.md)
   - 深入了解各模块功能
   - 学习模块间交互流程
   - 查看接口定义和示例代码

4. **运行Demo**: [demo/README.md](demo/README.md)
   - 按照说明配置环境
   - 启动服务进行测试
   - 根据需求自定义配置

### 方案2: 先跑Demo,快速体验

适合想快速看到效果的开发者:

1. **直接进入Demo目录**:
   ```bash
   cd demo
   ```

2. **按照README操作**:
   - 安装依赖: `pip install -r requirements.txt`
   - 配置环境: 复制`.env.example`到`.env`并填写
   - 启动服务: `python app.py`

3. **体验后再看文档**:
   - 理解代码背后的设计思路
   - 学习如何优化和扩展

## 📖 文档阅读指南

### 1. 项目总览 ([docs/PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md))

**适合**: 产品经理、技术负责人、架构师

**内容**:
- 项目简介和核心价值
- 技术架构概览(5大核心模块)
- 功能清单和路线图
- 成本分析和ROI估算
- 常见问题解答

**阅读时间**: 10-15分钟

### 2. 技术路线图 ([docs/TECH_ROADMAP.md](docs/TECH_ROADMAP.md))

**适合**: 后端工程师、架构师、技术负责人

**内容**:
- 完整技术架构图
- 技术栈选型和理由
- 5大核心模块详细设计
- 实施路线(4个阶段)
- 部署架构方案
- 关键技术决策分析
- 成本和风险评估

**阅读时间**: 20-30分钟

### 3. 模块功能说明 ([docs/MODULES.md](docs/MODULES.md))

**适合**: 开发工程师、代码实现者

**内容**:
- 模块架构总览
- 5个核心模块的功能清单
- 接口定义和代码示例
- 模块间交互流程
- 配置参数说明
- 性能优化建议
- 扩展性设计方案

**阅读时间**: 30-40分钟

### 4. Demo使用说明 ([demo/README.md](demo/README.md))

**适合**: 所有开发者

**内容**:
- 环境准备和依赖安装
- 飞书应用配置步骤
- 环境变量配置说明
- 启动和测试方法
- 核心模块代码说明
- 扩展功能实现指南
- 部署方案(Docker/systemd)
- 常见问题排查

**阅读时间**: 20-30分钟

## 🎯 不同角色的阅读建议

### 产品经理 / 项目经理

推荐阅读顺序:
1. ✅ [PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md) - 了解项目全貌
2. ✅ [TECH_ROADMAP.md](docs/TECH_ROADMAP.md) 中的"实现路线"部分 - 了解时间规划
3. ⚪ 快速浏览Demo代码结构

关注重点:
- 项目核心价值和ROI
- 功能清单和优先级
- 实施时间和成本
- 风险和挑战

### 技术负责人 / 架构师

推荐阅读顺序:
1. ✅ [PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md) - 快速了解背景
2. ✅ [TECH_ROADMAP.md](docs/TECH_ROADMAP.md) - 深入技术架构
3. ✅ [MODULES.md](docs/MODULES.md) - 理解模块设计
4. ✅ [demo/README.md](demo/README.md) - 了解实现细节

关注重点:
- 技术架构是否合理
- 技术栈选型理由
- 扩展性和性能
- 部署和运维方案

### 后端工程师

推荐阅读顺序:
1. ✅ [PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md) - 了解项目目标
2. ✅ [MODULES.md](docs/MODULES.md) - 学习模块设计
3. ✅ [demo/README.md](demo/README.md) - 跑通Demo
4. ✅ 阅读Demo源码 - 理解具体实现

关注重点:
- 模块职责和接口
- 代码结构和规范
- 如何扩展功能
- 测试和调试方法

### 前端工程师 / 客户端工程师

推荐阅读顺序:
1. ✅ [PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md) - 了解整体方案
2. ✅ [demo/README.md](demo/README.md) - 了解API接口
3. ⚪ 浏览飞书连接模块代码 - 了解消息格式

关注重点:
- 消息交互流程
- 支持的消息类型
- 如何接入其他渠道

## 💡 核心技术亮点

### 1. 模块化设计

5个独立模块,职责清晰,易于维护和扩展:
- 飞书连接模块
- 对话路由器
- AI对话引擎
- 知识库检索
- 产品知识管理

### 2. 智能路由

根据用户意图智能选择处理策略:
- 简单问候 → 直接回复(不调用LLM,节省成本)
- 产品介绍 → 使用产品知识库
- 复杂问题 → 查询飞书文档 + LLM综合

### 3. 灵活配置

通过配置文件轻松自定义:
- 产品信息和FAQ
- LLM模型选择
- 系统提示词
- 路由策略

### 4. 快速部署

提供多种部署方案:
- 本地开发(ngrok)
- Docker容器
- systemd服务
- Kubernetes集群

## 🔧 自定义和扩展

### 修改产品信息

编辑 [demo/product_knowledge.json](demo/product_knowledge.json):
```json
{
  "product": {
    "name": "你的产品名",
    "description": "产品描述...",
    ...
  },
  "faqs": [...]
}
```

### 调整AI行为

编辑 [demo/ai_engine.py](demo/ai_engine.py) 中的 `_build_system_prompt` 方法:
```python
def _build_system_prompt(self, context: Optional[str] = None) -> str:
    prompt = """
    你是XXX助手...
    你的职责是...
    """
    return prompt
```

### 添加新的意图类型

在 [demo/dialog_router.py](demo/dialog_router.py) 中:
1. 修改 `IntentClassifier.classify` 添加新意图识别
2. 在 `DialogRouter.handle_message` 添加新路由规则
3. 实现对应的处理方法

### 接入飞书文档搜索

在 [demo/feishu_connector.py](demo/feishu_connector.py) 中实现 `search_documents` 方法:
```python
def search_documents(self, query: str) -> list:
    # 调用飞书搜索API
    # 返回相关文档列表
    pass
```

## 🎓 学习资源

### 官方文档

- **飞书开放平台**: https://open.feishu.cn/document/
  - 消息API文档
  - 搜索API文档
  - SDK使用指南

- **Claude API**: https://docs.anthropic.com/
  - API参考
  - Prompt工程最佳实践
  - 费用计算

- **FastAPI**: https://fastapi.tiangolo.com/
  - 快速开始
  - 高级特性
  - 部署指南

### 推荐阅读

- **Prompt Engineering Guide**: 学习如何写好提示词
- **RAG (Retrieval Augmented Generation)**: 了解知识库增强生成
- **LangChain文档**: 学习AI应用编排框架

## ❓ 常见问题速查

### 技术问题

**Q: 如何切换到OpenAI而不是Claude?**
A: 修改 [demo/ai_engine.py](demo/ai_engine.py),将Anthropic客户端替换为OpenAI客户端。

**Q: 如何支持多轮对话?**
A: Demo已实现,在 `AIEngine` 类中通过 `conversation_history` 维护。

**Q: 如何添加消息格式(卡片/图片)?**
A: 参考飞书开放平台文档,在 `feishu_connector.py` 中添加新的发送方法。

### 部署问题

**Q: 本地开发如何让飞书访问?**
A: 使用ngrok: `ngrok http 8000`,将生成的URL配置到飞书webhook。

**Q: 生产环境如何部署?**
A: 参考 [demo/README.md](demo/README.md) 的"部署"章节,推荐使用Docker。

### 成本问题

**Q: API调用成本如何控制?**
A:
1. 对简单问题使用规则回复
2. 实现对话缓存
3. 限制对话历史长度
4. 设置每日调用上限

详见 [PROJECT_OVERVIEW.md - Q2](docs/PROJECT_OVERVIEW.md#q2-如何控制api成本)

## 📞 获取帮助

### 问题反馈

- 🐛 Bug报告: 提交Issue到项目仓库
- 💡 功能建议: 在项目仓库提交Feature Request
- 📖 文档问题: 提交文档Issue

### 技术支持

- 📧 技术支持: support@example.com
- 💼 商务合作: sales@example.com

## 📊 项目统计

- 📝 文档总字数: ~15000字
- 💻 代码行数: ~500行(不含注释)
- ⏱️ 预计学习时间: 2-3小时
- 🚀 快速上手时间: 30分钟

## ✅ 下一步行动

根据你的角色选择:

### 如果你是开发者:
1. ✅ 阅读 [PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md) (10分钟)
2. ✅ 阅读 [demo/README.md](demo/README.md) (20分钟)
3. ✅ 运行Demo并测试 (30分钟)
4. ✅ 根据需求修改配置和代码
5. ✅ 部署到测试环境
6. ✅ 收集反馈并优化

### 如果你是架构师/技术负责人:
1. ✅ 阅读 [PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md) (10分钟)
2. ✅ 深入阅读 [TECH_ROADMAP.md](docs/TECH_ROADMAP.md) (30分钟)
3. ✅ 评估技术方案是否符合需求
4. ✅ 制定实施计划
5. ✅ 分配任务给团队

### 如果你是产品经理:
1. ✅ 阅读 [PROJECT_OVERVIEW.md](docs/PROJECT_OVERVIEW.md) (15分钟)
2. ✅ 了解Demo功能和效果
3. ✅ 评估ROI和可行性
4. ✅ 制定产品规划
5. ✅ 协调资源和排期

---

**祝你使用愉快！如有问题,欢迎反馈。** 🎉
