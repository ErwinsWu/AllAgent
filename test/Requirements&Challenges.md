# ğŸ¦ OpenClaw Feishu Bot: æ¶æ„è®¾è®¡ä¸æŠ€æœ¯éš¾ç‚¹åˆ†æ

## 1. é¡¹ç›®èƒŒæ™¯
æœ¬é¡¹ç›®åŸºäº [AllAgent](https://github.com/ErwinsWu/AllAgent) çš„æ¼”è¿›æ€è·¯ï¼Œæ—¨åœ¨å¼ƒç”¨å•ä¸€ Agent æ¨¡å¼ï¼Œè½¬è€Œé‡‡ç”¨ **OpenClaw (Router) + Skills (å¤šæŠ€èƒ½)** çš„ç¼–æ’æ¶æ„ã€‚ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªä¼ä¸šçº§çš„é£ä¹¦æœºå™¨äººï¼Œèƒ½å¤Ÿæ™ºèƒ½åŒºåˆ†å¸¸è§„é—®ç­”ã€åŠ¨æ€æ–‡ä»¶åˆ†æå’Œé—²èŠæ„å›¾ã€‚

## 2. æ ¸å¿ƒæ¶æ„ï¼šOpenClaw + Skills
ç³»ç»Ÿç”±ä¸€ä¸ªä¸­å¤®æ§åˆ¶å™¨ï¼ˆOpenClawï¼‰å’Œä¸‰ä¸ªæ ¸å¿ƒæŠ€èƒ½æ¨¡å—ç»„æˆï¼š

*   **OpenClaw Core (Router)**: è´Ÿè´£æ„å›¾è¯†åˆ«ã€ä¼šè¯åˆ†å‘ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€‚
*   **Skill A: å¸¸è§„æé—® AI (General AI)**:
    *   åŸºäºæ•´ç†å¥½çš„ `FAQ.doc` (é«˜é¢‘é—®ç­”åº“)ã€‚
    *   è´Ÿè´£å¤„ç†é—²èŠã€é€šç”¨é—®é¢˜ã€å…¬å¸æ ‡å‡†æµç¨‹é—®ç­”ã€‚
    *   **ç‰¹ç‚¹**: å“åº”å¿«ï¼Œæˆæœ¬ä½ï¼Œå‡†ç¡®åº¦è¦æ±‚é«˜ã€‚
*   **Skill B: åŠ¨æ€çŸ¥è¯†åº“æŠ€èƒ½ (Dynamic RAG)**:
    *   è´Ÿè´£å¤„ç†ç”¨æˆ·åœ¨å¯¹è¯ä¸­å®æ—¶ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆPDF/Word/Txtï¼‰ã€‚
    *   è´Ÿè´£å¤„ç†ä¼ä¸šå†…éƒ¨é¢„è®¾çš„é™æ€çŸ¥è¯†åº“ï¼ˆé FAQ ç±»çš„å¤§å‹æ–‡æ¡£ï¼‰ã€‚
*   **Skill C: è§†è§‰ä¸è§£ææŠ€èƒ½ (Vision & OCR)**:
    *   è´Ÿè´£å¤„ç†å›¾ç‰‡ï¼ˆå‘ç¥¨ã€æˆªå›¾ã€æ‰«æä»¶ï¼‰ã€‚
    *   å…·å¤‡**æŠ—æ°´å°å¹²æ‰°**èƒ½åŠ›ï¼Œèƒ½æå–å›¾è¡¨æ•°æ®ã€‚

## 3. è¯¦ç»†åŠŸèƒ½éœ€æ±‚

### 3.1 æ™ºèƒ½é—®ç­”è·¯ç”±
- **FAQ ä¼˜å…ˆç­–ç•¥**: ç”¨æˆ·æé—®æ—¶ï¼Œç³»ç»Ÿéœ€ä¼˜å…ˆåœ¨ `Skill A` (FAQ) ä¸­åŒ¹é…ã€‚åªæœ‰å½“ç½®ä¿¡åº¦ä½äºé˜ˆå€¼ï¼ˆå¦‚ 0.6ï¼‰æ—¶ï¼Œæ‰è°ƒç”¨ `Skill B` å»æ£€ç´¢æ–‡æ¡£æˆ–æ–‡ä»¶ã€‚
- **é—²èŠå…œåº•**: å¯¹äºéä¸šåŠ¡ç±»é—®é¢˜ï¼ˆå¦‚â€œä½ å¥½â€ã€â€œè®²ä¸ªç¬‘è¯â€ï¼‰ï¼Œç”± General AI ç›´æ¥å›å¤ï¼Œä¸è§¦å‘ RAG æ£€ç´¢ã€‚

### 3.2 å¤šæ¨¡æ€æ–‡ä»¶å¤„ç†
- **åŠ¨æ€æ–‡ä»¶åˆ†æ**: ç”¨æˆ·åœ¨é£ä¹¦ç§èŠæˆ–ç¾¤èŠä¸­å‘é€æ–‡ä»¶ï¼ˆPDF/å›¾ç‰‡ï¼‰ï¼Œæœºå™¨äººéœ€å³æ—¶ä¸‹è½½ã€è§£æå¹¶å»ºç«‹ç´¢å¼•ï¼ˆVector Storeï¼‰ã€‚
- **å›¾ç‰‡ç†è§£**: æ”¯æŒè¯»å–å›¾ç‰‡ä¸­çš„æ–‡å­—ï¼ˆOCRï¼‰å’Œè§†è§‰ä¿¡æ¯ï¼ˆå¦‚åˆ†æè¶‹åŠ¿å›¾ï¼‰ï¼Œå¹¶èƒ½å¿½ç•¥èƒŒæ™¯æ°´å°ã€‚

### 3.3 ä¸Šä¸‹æ–‡ä¸è®°å¿†
- **å•äººç§èŠè®°å¿†**: è®°ä½ç”¨æˆ· A åœ¨è¿‡å» 10 è½®å¯¹è¯ä¸­çš„ä¸Šä¸‹æ–‡ã€‚
- **å¤šç¾¤ç»„éš”ç¦»**: Agent åœ¨â€œç¾¤ç»„ 1â€å’Œâ€œç¾¤ç»„ 2â€ä¸­çš„è®°å¿†å®Œå…¨ç‰©ç†éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°ã€‚

---

## 4. æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³å¯¹ç­– (Challenges & Solutions)

### 4.1 éš¾ç‚¹ï¼šæ–‡ä»¶æƒé™ä¸æ•°æ®éš”ç¦» (Security)
**é—®é¢˜**: å¦‚ä½•é˜²æ­¢ç”¨æˆ· B æŸ¥è¯¢åˆ°ç”¨æˆ· A ä¸Šä¼ çš„ç§å¯†å·¥èµ„å•ï¼Ÿ
*   **å¯¹ç­–**: **Metadata Filtering (å…ƒæ•°æ®è¿‡æ»¤)**
    *   **å…¥åº“æ—¶**: æ¯ä¸€æ¡å‘é‡æ•°æ®å¿…é¡»æ‰“æ ‡ã€‚
        *   å…¬å…± FAQ: `scope: global`
        *   ç§èŠæ–‡ä»¶: `scope: private`, `owner_id: {user_open_id}`
        *   ç¾¤èŠæ–‡ä»¶: `scope: group`, `group_id: {chat_id}`
    *   **æ£€ç´¢æ—¶**: å¼ºåˆ¶æ³¨å…¥ Filter æ¡ä»¶: `WHERE scope='global' OR (scope='private' AND owner_id=current_user)`.

### 4.2 éš¾ç‚¹ï¼šå›¾ç‰‡æ°´å°å¹²æ‰° (Watermark Resistance)
**é—®é¢˜**: ä¼ä¸šæˆªå›¾å¸¸å¸¦â€œæœºå¯†/ä»…ä¾›å†…éƒ¨ä½¿ç”¨â€çš„æ°´å°ï¼Œä¼ ç»Ÿ OCR ä¼šå°†è¿™äº›å­—æ··å…¥æ­£æ–‡ï¼Œå¯¼è‡´è¯­ä¹‰å´©åã€‚
*   **å¯¹ç­–**: **Vision Model Prompting + é¢„å¤„ç†**
    *   ä½¿ç”¨å…·å¤‡è§†è§‰èƒ½åŠ›çš„å¤§æ¨¡å‹ (GPT-4o / Claude 3.5 Sonnet)ã€‚
    *   **System Prompt**: *"You are a document analyzer. Please extract the main text content and ignore any background watermarks (e.g., 'Confidential', 'Internal Use Only'). Do not include watermark text in your response."*
    *   (å¯é€‰) ä½¿ç”¨ OpenCV å¯¹å›¾ç‰‡è¿›è¡Œé¢‘åŸŸæ»¤æ³¢å»å™ªã€‚

### 4.3 éš¾ç‚¹ï¼šFAQ ä¸æ–‡æ¡£çš„çŸ¥è¯†å†²çª (Conflict Resolution)
**é—®é¢˜**: FAQ è§„å®šâ€œæµç¨‹æ˜¯ Aâ€ï¼Œä½†ç”¨æˆ·ä¸Šä¼ çš„æ—§æ–‡ä»¶è¯´â€œæµç¨‹æ˜¯ Bâ€ã€‚
*   **å¯¹ç­–**: **ç½®ä¿¡åº¦ç†”æ–­æœºåˆ¶**
    *   è®¾å®šè·¯ç”±é€»è¾‘ï¼š`if FAQ_Similarity_Score > 0.9: return FAQ_Answer; else: Execute_RAG_Search()`.
    *   ç¡®ä¿æ ‡å‡†ç­”æ¡ˆ (FAQ) æ°¸è¿œå‹å€’è¿‡æ—¶æ–‡æ¡£ã€‚

### 4.4 éš¾ç‚¹ï¼šé£ä¹¦ 3 ç§’è¶…æ—¶ä¸å¼‚æ­¥å¤„ç† (Concurrency)
**é—®é¢˜**: é£ä¹¦è¦æ±‚ 3 ç§’å†…å“åº”ï¼Œè€Œåˆ†æ PDF/å›¾ç‰‡é€šå¸¸éœ€è¦ 5-15 ç§’ã€‚è¶…æ—¶ä¼šå¯¼è‡´é£ä¹¦é‡è¯•ï¼Œæœºå™¨äººé‡å¤è¯´è¯ã€‚
*   **å¯¹ç­–**: **Producer-Consumer æ¨¡å‹**
    *   **Web Server**: æ”¶åˆ°è¯·æ±‚ -> æ‰”è¿› Redis é˜Ÿåˆ— -> **ç«‹å³è¿”å› HTTP 200 (ç©º)**ã€‚
    *   **Worker**: åå°æ…¢æ…¢å¤„ç† -> å¤„ç†å®Œä¸»åŠ¨è°ƒç”¨é£ä¹¦ API (`im/v1/messages`) å‘é€ç»“æœã€‚
