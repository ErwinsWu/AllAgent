# 🧪 OpenClaw Feishu Bot: 详细测试用例清单

## 1. 权限与隔离测试 (Security & Isolation)
**核心目标**: 确保数据绝不泄露给无权访问的人。

| ID | 测试场景 | 操作步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **S-01** | **跨群组文件隔离** | 1. 在群 A 上传 `Project_Secret.pdf`。<br>2. 在群 B 问：“Project Secret 的内容是什么？” | 机器人回复：“未找到相关信息”或“无权访问该文件”。 |
| **S-02** | **私聊文件隔离** | 1. 用户 A 私聊上传 `UserA_Salary.pdf`。<br>2. 用户 B 私聊机器人：“查一下 UserA 的工资”。 | 机器人回复：“未找到相关信息”。 |
| **S-03** | **混合检索权限** | 1. 用户 A 上传私有文件。<br>2. 提问一个既涉及 FAQ (公开) 又涉及私有文件的问题。 | 机器人能结合两者回答，但如果用户 B 问同样问题，只能得到 FAQ 的部分。 |

## 2. 路由与优先级测试 (Routing & Priority)
**核心目标**: 验证 General AI (FAQ) 与 Dynamic RAG 之间的调度逻辑。

| ID | 测试场景 | 操作步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **R-01** | **FAQ 绝对优先** | 1. FAQ 定义“全勤奖 500元”。<br>2. 上传旧文件写“全勤奖 200元”。<br>3. 提问：“全勤奖多少？” | **必须**回答 500元 (FAQ 答案)。 |
| **R-02** | **闲聊不触发检索** | 1. 提问：“你今天开心吗？”或“写首诗”。 | 由 General AI 直接回复，**不显示**“正在分析文件”或“未找到文档”等 RAG 错误提示。 |
| **R-03** | **未知问题兜底** | 1. 提问一个完全不存在于 FAQ 也不在文件里的业务问题。 | 机器人礼貌回复：“知识库中暂无此信息，请咨询人工。” **严禁编造答案(幻觉)**。 |

## 3. 图片与水印对抗测试 (Vision & Watermark)
**核心目标**: 验证在干扰环境下的 OCR 准确率。

| ID | 测试场景 | 操作步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **V-01** | **强文字水印** | 1. 发送一张正文被“内部绝密”斜体水印覆盖的文档截图。<br>2. 要求总结内容。 | 总结内容准确，且文字中**不包含**重复的“内部绝密”字样。 |
| **V-02** | **图表数据理解** | 1. 发送一张销售趋势折线图（无具体数字文本）。<br>2. 问：“哪个月增长最快？” | 机器人能正确识别图表趋势并回答月份。 |
| **V-03** | **混合输入** | 1. 发送图片。<br>2. 同一条消息附带文字：“把图里的数据翻译成英文”。 | 机器人能同时处理 Image + Text Prompt，输出英文数据。 |
| **V-04** | **模糊图片** | 1. 发送低分辨率或手抖拍摄的照片。 | 能识别主要内容，若无法识别应明确提示“图片太模糊，请重新上传”。 |

## 4. 上下文与状态管理测试 (Context & State)
**核心目标**: 验证多轮对话的连贯性。

| ID | 测试场景 | 操作步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **C-01** | **长对话记忆** | 1. 上传文件 A。<br>2. 聊 5 轮无关话题（天气、笑话）。<br>3. 突然问：“回到刚才文件 A，第 3 页说了什么？” | 机器人依然能准确回答文件 A 的内容。 |
| **C-02** | **话题切换** | 1. 问 FAQ 问题。<br>2. 传文件 B 问文件问题。<br>3. 再问 FAQ 问题。 | 机器人能在 Skill A 和 Skill B 之间流畅切换，不卡死。 |

## 5. 飞书平台特性与并发测试 (Platform & Performance)
**核心目标**: 验证系统在飞书真实环境下的稳定性。

| ID | 测试场景 | 操作步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **P-01** | **超时重试机制** | 1. 发送一个需要 20秒 才能解析完的超大 PDF。<br>2. 观察飞书聊天窗口。 | 机器人**只回复一次**最终结果，没有因为飞书重试机制导致回复两遍。 |
| **P-02** | **高频并发** | 1. 在群里 1 秒内连续发 3 个不同的问题。 | 机器人按顺序或并行处理，**不漏掉**任何一个问题，且回复对应正确。 |
| **P-03** | **文件格式异常** | 1. 发送一个 `.exe` 或损坏的 `.pdf`。 | 机器人提示“不支持的文件格式”或“无法解析”，后台服务**未崩溃**。 |
